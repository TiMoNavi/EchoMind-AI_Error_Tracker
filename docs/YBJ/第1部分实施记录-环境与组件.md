# 第1部分实施记录：Flutter 环境与组件体系

## 1. 已完成事项

### 1.1 环境与版本管理
- 已安装 Dart SDK（3.11.0）。
- 已安装 FVM（4.0.5）。
- 已通过 FVM 安装 Flutter stable（3.41.1）。
- 已创建项目：`mistake_book`（组织名 `com.yourname`）。
- 已在项目内执行 `fvm use stable`，并生成 `.fvm/fvm_config.json`。

### 1.2 项目初始化
- 项目路径：`mistake_book/`
- 已重写 `lib/main.dart` 为可运行的初始化骨架：
  - `GetMaterialApp`
  - `ScreenUtilInit`
  - 基础服务注册与启动验证页面

### 1.3 已预留基础接口（第1部分要求）
- `AppEnvConfig`：`lib/app/config/app_env_config.dart`
- `ThemeSettingsService`：`lib/app/services/theme_settings_service.dart`
- `LocalDbService`：`lib/app/services/local_db_service.dart`
- `PermissionService`：`lib/app/services/permission_service.dart`
- `FormulaRenderAdapter`：`lib/app/services/formula_render_adapter.dart`

---

## 2. 依赖分层状态

## 2.1 P0（已安装）
- `get`
- `flutter_screenutil`
- `flutter_svg`
- `flutter_animate`
- `simple_shadow`
- `intl`
- `shared_preferences`

## 2.2 Dev（已安装）
- `flutter_lints`
- `build_runner`
- `isar_generator`

## 2.3 P1（暂未安装，按功能进入前再装）
- `flutter_tex`
- `isar`
- `isar_flutter_libs`
- `permission_handler`
- `image_picker`

## 2.4 P2（暂未安装，升级阶段再装）
- `cunning_document_scanner`
- `image_editor_plus`
- `bitsdojo_window`
- `get_storage`（可选）

分层安装命令（后续执行）：
```bash
# P1
fvm flutter pub add flutter_tex isar isar_flutter_libs permission_handler image_picker

# P2
fvm flutter pub add cunning_document_scanner image_editor_plus bitsdojo_window get_storage
```

---

## 3. 组件-功能-启用时机

| 组件 | 主要用途 | 典型功能点 | 启用时机 |
|---|---|---|---|
| `get` | 全局架构 | 路由、Controller、依赖注入 | 项目初始化即启用 |
| `flutter_screenutil` | 多端尺寸适配 | 字号、间距、圆角自适应 | 项目初始化即启用 |
| `flutter_svg` | 图标渲染 | 顶部栏/底栏/功能图标 | 首页阶段启用 |
| `flutter_animate` | 过渡动效 | 卡片入场、按钮反馈 | 首页阶段启用 |
| `simple_shadow` | 视觉层级 | 玻璃卡片阴影和悬浮感 | 首页阶段启用 |
| `shared_preferences` | 本地偏好 | 主题模式、开关状态 | 首页阶段启用 |
| `flutter_tex` | 公式展示 | 题目公式、AI讲解公式块 | 进入题目/训练页前启用 |
| `isar` | 本地数据库 | 错题库、上传历史、搜索缓存 | 进入数据层实现时启用 |
| `permission_handler` | 权限统一 | 相机/麦克风权限弹窗 | 拍照与语音功能前启用 |
| `image_picker` | 最小拍照能力 | 先打通拍照入口 | 拍照功能首版启用 |
| `cunning_document_scanner` | 高级扫描 | 自动裁剪、透视矫正 | 上传流程升级阶段启用 |
| `image_editor_plus` | 图片编辑 | 涂鸦、标注、旋转 | 上传流程升级阶段启用 |
| `bitsdojo_window` | Windows外壳 | 无边框窗口、尺寸控制 | 桌面体验优化阶段启用 |

---

## 4. 命令执行说明

> 终端若无法直接识别 `fvm`，请先确保以下路径在 PATH 中：  
> `C:\Users\Administrator\AppData\Local\Pub\Cache\bin`

常用命令（统一使用 FVM）：
```bash
fvm flutter --version
fvm flutter doctor -v
fvm flutter pub get
fvm flutter analyze
```

Web 运行/构建注意（Flutter 3.41.1）：
- `--web-renderer` 参数已移除，旧命令会报错。
- 本地调试使用：`fvm flutter run -d chrome`
- 构建使用：`fvm flutter build web`
- 如需尝试 Wasm：`fvm flutter build web --wasm`

---

## 5. 已知约束
- Windows 本机无法本地构建 iOS，iOS 构建验证需在 Mac/CI 完成。
- `flutter_tex` / `isar` / 权限相关库在第1部分未接入，当前已通过适配层预留接口。
