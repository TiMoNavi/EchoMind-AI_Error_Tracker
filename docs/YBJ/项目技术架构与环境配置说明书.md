# 项目技术架构与环境配置说明书 (v2.0)

## 1. 项目本质与技术硬约束 (Core Constraints)

本项目是一个 **“高中理科错题管理系统”**。
由于业务涉及高中数学/物理/化学，且需覆盖 **Windows PC, Web, Android, iOS** 四端，技术选型必须满足以下硬性指标：

### 1.1 核心组件选型理由 (Why these libraries?)

* **渲染 LaTeX 公式 (Critical)**
  * **组件**: `flutter_tex`
  * **理由**: 高中题目包含大量复杂数学/物理公式（如积分、根号、化学方程式）。普通文本组件无法渲染，必须嵌入基于 WebView 或 KaTeX 的渲染引擎。
* **高性能本地存储 (Local First)**
  * **组件**: `isar`
  * **理由**: 错题本涉及海量数据（题目文本、标签、大量图片路径）。需要一个比 SQLite 更快、支持全文搜索（Full-Text Search）的 NoSQL 数据库，以实现毫秒级搜题。
* **文档图像处理**
  * **组件**: `cunning_document_scanner` (Mobile) / `image_editor_plus`
  * **理由**: 输入源主要是“试卷拍照”。必须具备“边缘检测、自动裁剪、透视矫正”以及“图片涂鸦/标注”能力。
* **状态与路由管理**
  * **组件**: `get` (GetX)
  * **理由**: 这是一个 18+ 个页面的中大型应用。需要 GetX 简洁的依赖注入系统来解耦 UI 和 业务逻辑，且 GetX 的路由管理在多端（尤其是 Web URL 处理）上相对方便。
* **PC 端窗口增强**
  * **组件**: `bitsdojo_window`
  * **理由**: Windows 原生窗口标题栏与“极光玻璃态”UI 风格严重冲突，需接管窗口绘制权，实现无边框沉浸式体验。

---

## 2. 多端跨平台适配策略 (Cross-Platform Strategy)

由于本项目目标是 **All-in-One Codebase**，必须在架构层注意以下平台差异：

### A. Web 端 (浏览器)

* **渲染器**: 强制使用 `Canvaskit` (构建时 `flutter build web --web-renderer canvaskit`) 以保证字体渲染和 Skia 性能，否则玻璃态效果会失效或卡顿。
* **CORS 问题**: 图片如存储在外部服务器，需处理跨域加载问题。
* **本地存储差异**: Isar 在 Web 端基于 IndexedDB，需确保 Web Worker 配置正确。

### B. Windows PC 端

* **输入设备**: 必须适配“鼠标悬停 (Hover)”和“右键菜单”。不能只依赖触摸手势。
* **窗口尺寸**: 屏幕宽大，布局需响应式。不能简单拉伸手机界面，需使用 `flutter_screenutil` 或 `LayoutBuilder` 做分栏布局。
* **性能瓶颈**: 这里的 `BackdropFilter` (高斯模糊) 是资源消耗大户。**禁止**在长列表 (ListView) 的 Item 中使用实时模糊，仅在静态层（Header/Sidebar）使用。

### C. iOS / Android 移动端

* **权限管理**: 需配置 `Info.plist` (iOS) 和 `AndroidManifest.xml` (Android) 的相机、相册、网络权限。
* **安全区域**: 必须全局包裹 `SafeArea`，并在刘海屏/灵动岛区域做特殊 UI 适配。

---

## 3. 环境初始化指令 (Initialization Instructions)

**To AI Assistant (Claude Code / Cursor):**

请基于上述技术约束，执行以下初始化操作：

1. **创建项目**: 初始化一个名为 `mistake_book` 的 Flutter 项目，组织名 `com.yourname`。
2. **依赖注入**: 修改 `pubspec.yaml`，加入以下核心库的最新版本：
   * `get`, `flutter_screenutil` (架构)
   * `flutter_tex`, `isar`, `isar_flutter_libs` (业务核心)
   * `bitsdojo_window` (Windows 专用)
   * `flutter_animate`, `simple_shadow` (UI 动效)
   * `flutter_svg` (矢量资源)
3. **目录结构**: 在 `lib/` 下建立标准的 GetX 模块化结构：
   * `app/data/` (Models, Providers, Services)
   * `app/modules/` (Pages/Views, Controllers - **预留好 Home 模块即可**)
   * `app/routes/` (AppPages, AppRoutes)
   * `app/global_widgets/` (存放自定义组件)
4. **Windows 配置**: 生成 `windows/runner/main.cpp` 的修改代码，以启用 `bitsdojo_window`。
5. **入口文件**: 重写 `main.dart`，配置 `GetMaterialApp`，初始化 `ScreenUtil`，并设置 Windows 窗口的默认大小。

**注意**: 不要生成任何具体的业务页面（如预测中心、错题详情），只搭建空壳架构和环境配置。
