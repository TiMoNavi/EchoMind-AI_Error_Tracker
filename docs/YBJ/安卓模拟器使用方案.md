# 安卓模拟器使用方案（Flutter + FVM）

## 1. 目标
- 在 Windows 环境稳定启动 Android 模拟器。
- 能用 Flutter 直接运行 `mistake_book`。
- 遇到 `offline`、无法识别设备等问题时可快速恢复。

## 2. 推荐方案（按优先级）
1. 直接使用现有 AVD（最快）：`Pixel_Fold_API_35`
2. 用 Android Studio Device Manager 图形化启动（适合新手）
3. 真机 USB 调试（性能通常更好，作为备选）

## 3. 前置检查
在项目目录 `d:\AI\AI+high school homework\mistake_book` 执行：

```powershell
C:\Users\Administrator\fvm\versions\stable\bin\flutter.bat doctor -v
C:\Users\Administrator\fvm\versions\stable\bin\flutter.bat emulators
```

如果你本机 `fvm` 已加入 PATH，也可以使用：

```powershell
fvm flutter doctor -v
fvm flutter emulators
```

## 4. 快速启动（命令行）
1. 启动模拟器：

```powershell
C:\Users\Administrator\fvm\versions\stable\bin\flutter.bat emulators --launch Pixel_Fold_API_35
```

2. 等待 15-40 秒后检查设备：

```powershell
C:\Users\Administrator\fvm\versions\stable\bin\flutter.bat devices
```

3. 运行项目：

```powershell
C:\Users\Administrator\fvm\versions\stable\bin\flutter.bat run -d emulator-5554
```

## 5. 每日开发流程（建议固定）
1. 先开模拟器，再启动 Flutter（避免设备枚举失败）。
2. 先跑 `flutter devices`，确认状态是 `device`，不是 `offline`。
3. 开发过程中优先热重载（`r`），减少完整重启次数。
4. 每天首次启动建议“冷启动”（不要加载快照），稳定性更好。

## 6. 常见问题与处理

### 6.1 设备显示 `offline`
执行：

```powershell
C:\Users\Administrator\AppData\Local\Android\Sdk\platform-tools\adb.exe kill-server
C:\Users\Administrator\AppData\Local\Android\Sdk\platform-tools\adb.exe start-server
C:\Users\Administrator\AppData\Local\Android\Sdk\platform-tools\adb.exe devices -l
```

然后关闭并重开模拟器（建议冷启动）。

### 6.2 `flutter devices` 看不到安卓设备
检查：
1. 模拟器窗口是否真的启动完成（能进入桌面）。
2. `adb devices -l` 是否有 `emulator-5554`。
3. 重新执行 `flutter devices`（有时会晚几秒识别）。

### 6.3 模拟器启动慢/卡顿
建议：
1. AVD RAM 设为 4096MB 左右（不要过大）。
2. 开启 Host GPU 加速。
3. 关闭不必要后台程序，避免内存挤占。
4. 优先使用 x86_64 系统镜像。

### 6.4 提示同一 AVD 重复运行
先关闭旧实例再启动新实例，避免重复占用：

```powershell
C:\Users\Administrator\AppData\Local\Android\Sdk\platform-tools\adb.exe -s emulator-5554 emu kill
```

## 7. 图形化方案（Android Studio）
1. 打开 Android Studio -> `More Actions` -> `Device Manager`
2. 找到 `Pixel_Fold_API_35`，点击 `▶` 启动
3. 回到项目目录执行：

```powershell
C:\Users\Administrator\fvm\versions\stable\bin\flutter.bat devices
C:\Users\Administrator\fvm\versions\stable\bin\flutter.bat run -d emulator-5554
```

## 8. 何时改用真机
以下场景建议直接真机：
1. 需要验证相机、权限、通知等原生能力。
2. 模拟器性能不足影响 UI/动画调试。
3. 需要更接近实际触控与字体渲染表现。

## 9. 当前项目建议
- 日常 UI 开发：优先 `Pixel_Fold_API_35` 模拟器。
- 功能联调（拍照/权限）：使用 Android 真机做补充验证。
- 统一命令：团队内优先 `fvm flutter ...`，避免 SDK 版本漂移。
