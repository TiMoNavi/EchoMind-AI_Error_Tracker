# 产品功能域划分与数据关联图

> 基于 core_framework_v2.0.md 的功能重组版本
> 视角：产品经理（按功能内聚 + 数据耦合度组织）
> 创建日期：2026-02-10

---

## 〇、全局概览：12个功能域 + 6个核心数据实体

### 核心数据实体

| # | 数据实体 | 关键字段 | 被哪些功能域读/写 |
|---|---------|---------|----------------|
| D1 | **学生(Student)** | target_score, exam_strategy, reading_accuracy, predicted_score, 三维画像 | 几乎所有功能域 |
| D2 | **知识点(KnowledgePoint)** | current_level(0-5), peak_level, conclusion_level(1/2), related_models[] | 域2/域4/域5/域8/域9 |
| D3 | **模型(Model)** | current_level(0-5), peak_level, is_unstable, last_error_subtype, confusion_groups[], next_retest_date | 域3/域4/域5/域6/域8/域9 |
| D4 | **题目(Question)** | is_correct, primary_model_id, related_kp_ids[], diagnosis_status, exam_question_number | 域4/域5/域6/域8 |
| D5 | **闪卡(Flashcard)** | ease_factor, interval, repetitions, 卡片类型(9种) | 域7（独立域） |
| D6 | **地区模板(RegionalTemplate)** | exam_structure, question_strategies, diagnosis_path, question_map | 域1/域8/域9/域10 |

### 12个功能域一览

| # | 功能域 | 核心职责 | 涉及原文Section | 主要读写的数据 |
|---|-------|---------|----------------|--------------|
| 域1 | 注册与初始化 | 学生画像建立、卷面策略生成、初始诊断 | §14, §46 | D1写, D3写, D6读 |
| 域2 | 知识点学习 | 知识点5步学习、概念检测、掌握度管理 | §3, §6, §7, §18, §26, §40 | D2读写 |
| 域3 | 模型训练 | 6步专项训练、快检、审题、易混对比 | §5(部分), §12, §19, §33, §34, §37, §38, §43 | D3读写, D2读 |
| 域4 | AI诊断 | 错题诊断分流、四层定位、深度诊断 | §2, §23, §36(部分), §42, §45 | D4读写, D3写, D2写 |
| 域5 | 错题与上传 | 题目上传、识别、标注、考试卷子处理 | §30, §47, §49 | D4写, D3写 |
| 域6 | 状态追踪引擎 | 后端标签管理、升降级规则、遗忘保护 | §29 | D2写, D3写, D1写 |
| 域7 | 闪卡与记忆 | 9类闪卡、SM-2算法、间隔复习 | §15 | D5读写 |
| 域8 | 预测系统 | 分数预测、卷面策略联动、预测展示 | §27, §28, §52 | D1写, D3读, D2读, D6读 |
| 域9 | 推荐与复盘 | 主页推荐、冷启动、周复盘、等待期利用 | §10, §31, §50, §54 | D3读, D2读, D1读, D6读 |
| 域10 | 路由调度 | 闭环架构、路由规则、跨模型依赖 | §16, §51 | D2读, D3读 |
| 域11 | 架构与导航 | Tab架构、页面清单、版本范围、约束 | §1, §4, §13, §17, §44 | — |
| 域12 | 商业与运营 | 定价、分销、社区、可视化展示 | §25, §48, §55, §56 | D1读, D3读 |

---

## 一、功能域详细拆解

---

### 域1：注册与初始化 🚀

> **职责**：从0到1建立学生画像，让系统能运转起来

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 注册三步流程 | §14 | 基础信息 → 卷面策略 → 自适应AI诊断 |
| 卷面策略生成 | §14 | 纯规则，0成本。根据目标分+地区模板生成🔴🟡⚪ |
| 自适应AI诊断 | §14 | 15-30分钟，~1-1.5元。输出三维画像+模型初始Level |
| 目标分数变更 | §14 | 修改目标分→重算策略→推荐重排 |
| 地区卷面结构模板 | §46 | 教研人工设计，每城市×科目×分数档一份 |

#### 数据流（写入）

```
注册流程写入的数据：

Student（D1）：
├── region_id, target_score
├── exam_strategy（卷面策略表）
├── formula_memory_rate, model_identify_rate, calculation_accuracy（三维画像）

Model（D3）× N个：
├── 做对的模型 → current_level=4, peak_level=4
├── 做错(识别错) → current_level=1, peak_level=1
├── 做错(决策错) → current_level=2, peak_level=2
├── 做错(执行错) → current_level=3, peak_level=3
└── 未覆盖的模型 → current_level=0, peak_level=0
```

#### 数据依赖（读取）

```
← RegionalTemplate（D6）：加载地区卷面结构模板
```

#### 下游消费者

```
→ 域3（模型训练）：初始Level决定训练入口
→ 域8（预测系统）：exam_strategy + 初始Level → 首次预测分
→ 域9（推荐系统）：exam_strategy中🔴模型 → 推荐优先级
→ 域10（路由调度）：Level决定路由入口Step
```

---

### 域2：知识点学习体系 📚

> **职责**：管理知识点的学习、检测、掌握度追踪

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 知识点5步学习流程 | §3 | 预设内容+AI引导：状态判断→呈现→确认→检测→完成+闪卡 |
| 知识点掌握度(L0-L5) | §6 | 记不住(L1)/理解不深(L2)/使用出错(L3)/能用(L4)/稳定(L5) |
| 概念检测触发场景 | §7 | 4场景：主动学习/诊断分流/模型训练暴露/周防腐 |
| 知识点详情页 | §18 | 掌握度+学习入口+关联模型+检测记录 |
| 一级/二级结论 | §26, §40 | 一级=理解原理，二级=记住即可；影响学习路径 |
| recall测试(自适应) | §6 | 开放recall→失败切recognition→连续失败触发记忆辅助 |

#### 核心数据模型

```
KnowledgePoint（D2）：
├── current_level: 0-5         // 当前掌握度
├── peak_level: 0-5            // 历史最高
├── conclusion_level: 1|2      // 一级/二级结论 → 决定学习路径（完整5步 vs 简化3步）
├── related_models: [model_id] // 被哪些模型使用
├── last_active: timestamp
├── error_count / correct_count
└── 无is_unstable（知识点不设此字段）
```

#### 掌握度流转

```
L0(未接触) → L1(记不住): recall失败/AI暴露记忆缺口
L1 → L2(理解不深): 能回忆但解释失败/条件检测错
L2 → L3(使用出错): 能解释但检测题用错
L3 → L4(能正确使用): 检测对+解释对 ≥1次
L4 → L5(稳定掌握): 延时复测通过(≥24h间隔)≥2次
L4/L5 → 降级: 做错→退回出错的层(L1/L2/L3)
```

#### 数据依赖

```
← 域4（AI诊断）：诊断结果=知识点缺口 → 分流到知识点学习
← 域3（模型训练）：训练中暴露知识点不会 → 插入快检
← 域5（上传）：上传标错 → 关联知识点last_active更新
← 域6（状态引擎）：标签更新算法 → 读写current_level
```

#### 下游消费者

```
→ 域3（模型训练）：模型详情页显示前置知识点掌握度
→ 域7（闪卡）：学完自动生成概念卡/条件卡/辨析卡
→ 域8（预测系统）：kp_mastery → 预测公式的输入
→ 域10（路由调度）：current_level → 决定从5步的哪步开始
```

---

### 域3：模型训练体系 💪

> **职责**：6步专项训练 + 模型掌握度管理 + 辅助训练模块

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 6步专项训练 | §5(部分), §19 | 过程拆分+识别→决策→步骤→陷阱→回归→变式 |
| 模型掌握度(L0-L5) | §8 | 建模卡住(L1)/列式卡住(L2)/执行卡住(L3)/做对过(L4)/稳定(L5) |
| 延时复测机制 | §8 | L4后：3天→7天→30天，用变式题 |
| 模型详情页 | §12 | 掌握度+前置知识点+相关题目+训练入口 |
| 过程拆分与主语 | §33 | Step 1核心：拆过程→定主语→选模型 |
| "不敢写"检测 | §34 | Step 5超90秒→AI鼓励+方法提示 |
| 易混模型对比表 | §37 | 教研预设易混组→诊断为识别/决策错时展示对比表 |
| 审题训练 | §38 | 独立模块：过程重述（几个过程/主语/特征/转折点） |
| 快检题 | §43 | 1题30秒测识别能力，last_active>14天触发 |
| 首次学习验证题 | §16(部分) | 每个模型预设1-2道母题，首次Step 5用 |

#### 核心数据模型

```
Model（D3）：
├── current_level: 0-5          // 当前掌握度（编码瓶颈层）
├── peak_level: 0-5             // 历史最高
├── is_unstable: bool           // 最近4次既有对又有错
├── last_error_subtype: enum    // 最近错误子类
├── recent_results: [bool; 4]   // 最近4次对错记录
├── confusion_groups: [string]  // 所属易混组
├── next_retest_date: timestamp // 延时复测日期
├── required_knowledge_points: [kp_id] // 前置知识点
└── last_active: timestamp
```

#### 掌握度流转

```
L0(未接触) → L1(建模卡住): AI诊断=识别错
L0 → L4: 首次做对（直接跳过L1-L3）
L1 → L2: Step 1通过但Step 2失败
L1 → L4: Step 1通过+后续全通过（可跨级）
L2 → L3: Step 2通过但Step 3-5失败
L3 → L4: Step 5回归题做对
L4 → L5: Step 6变式对+延时复测通过(≥24h, ≥2次)
L4/L5做错 → 精确降级: 识别错→L1, 决策错→L2, 执行错→L3
```

#### 数据依赖

```
← 域4（AI诊断）：诊断结果 → 决定从哪个Step开始
← 域5（上传）：上传标错 → 关联模型标签更新
← 域6（状态引擎）：标签更新算法 → 读写current_level
← 域2（知识点）：检查前置知识点掌握度
← D6（地区模板）：confusion_groups、model_prerequisites、model_relations
```

#### 下游消费者

```
→ 域7（闪卡）：每步完成自动生成对应闪卡（Step1→识别卡, Step2→决策卡...）
→ 域8（预测系统）：model_mastery → 预测公式输入
→ 域9（推荐系统）：is_unstable/last_active/current_level → 推荐排序
→ 域2（知识点）：训练中暴露知识点缺口 → 触发知识点检测
```

---

### 域4：AI诊断体系 🔍

> **职责**：定位错误根源（粗心/知识点/模型），精确到四层中的哪一层

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| AI诊断分流 | §2 | 做错题→最多5轮对话→判断错误根源（3大类+子类） |
| 四层诊断定位 | §2 | 建模层→列式层→执行层→结论：瓶颈在第X层 |
| 三段式话术输出 | §2 | ①定位问题 ②说明可解决 ③关联目标分 |
| AI诊断轮数 | §23 | 最大5轮（快检→追问→深挖→确认→收敛） |
| 不稳定深度诊断 | §36(部分) | 同一模型时对时错→追问更深→找微观错误点 |
| AI人格设定 | §42 | 全局基础（耐心+简洁+不放水）+ 模块微调 |
| 粗心细分记录 | §39 | 计算错/符号错/审题错/抄错，V1仅记录 |

#### 错误分类树

```
做错题
├── 粗心/计算（低价值）
│   ├── 计算错
│   ├── 符号错
│   ├── 审题错
│   └── 抄错
│   → 记录+周末粗心消杀，不改level
│
├── 知识点缺口（新增）
│   → 引导到域2：知识点学习流程
│
└── 模型应用缺口（高价值）
    ├── 识别错（不知道用哪个模型）→ 建模层L1
    ├── 决策错（模型对但公式选错）→ 列式层L2
    ├── 步骤错（公式对但执行出错）→ 执行层L3
    ├── 主语错（公式对但对错了对象）→ 执行层L3
    └── 代入错（物理量代入错误）→ 执行层L3
    → 引导到域3：模型训练对应Step
```

#### 数据流

```
输入（读取）：
← D4.Question：题目信息
← D3.Model：current_level, is_unstable, last_error_subtype
← D2.KnowledgePoint：current_level
← D1.Student：target_score, exam_strategy, common_errors

输出（写入）：
→ D4.Question：diagnosis_status=completed, diagnosis_result
→ D3.Model：current_level精确降级（识别错→L1, 决策错→L2, 执行错→L3）
→ D3.Model：last_error_subtype更新
→ D2.KnowledgePoint：如诊断出知识点缺口→current_level更新

路由输出：
→ 域2（知识点学习）：诊断=知识点缺口时
→ 域3（模型训练）：诊断=模型应用缺口时，精确到Step
→ 域5.粗心消杀：诊断=粗心时
```

---

### 域5：错题与上传体系 📤

> **职责**：题目的入口——上传、识别、归档、待诊断管理

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 统一"+"上传入口 | §30 | 3种上传类型：作业/极简/考试卷子 |
| 拍照上传流程 | §30 | 拍照→AI识别→逐题标对/错→系统关联模型/知识点 |
| 题目识别与匹配 | §30 | 大模型打标签，~0.1元/次 |
| 题目归属规则 | §30 | 1题→1主模型 + N知识点标签 + 1题号 + 1上传批次 |
| 统一上传历史 | §30 | 时间倒序，可筛选，错题筛选=智能错题本 |
| 上传考试卷子 | §47 | 标准结构快速映射(0元) / 非标准AI识别(~0.3元) |
| "半对"处理 | §47 | 得分率≥0.7不降/0.3-0.7降1级/<0.3等同错 |
| 每日上传机制 | §29(部分) | 极简上传，约3分钟/天，承担发现问题+保护遗忘双功能 |
| 未诊断超时处理 | §49 | 3天内推荐诊断，超时→默认降到L3 |
| 错题闭环 | §5(部分) | 四路分诊：粗心/知识点缺口/模型不会/审题错 |

#### 核心数据模型

```
Question（D4）：
├── source: homework | practice | exam
├── upload_batch_id
├── image_url
├── is_correct: bool
├── primary_model_id          // 主归属模型（大模型打标签）
├── related_kp_ids: [string]  // 关联知识点
├── exam_question_number: int // 仅考试卷子
├── diagnosis_status: pending | diagnosed | skipped
├── diagnosis_result: {error_type, error_subtype, confidence}
└── created_at
```

#### 数据流

```
上传写入：
→ D4.Question：新建题目记录
→ D3.Model：标"对"→更新last_active; 标"错"→标记待诊断
→ D2.KnowledgePoint：更新last_active
→ D1.Student：total_closures更新

上传读取：
← D6.RegionalTemplate：考试卷子上传时加载卷面结构

下游触发：
→ 域4（AI诊断）：标错的题 → diagnosis_status=pending → 推荐诊断
→ 域9（推荐系统）：待诊断错题进入推荐候选池（最高优先级）
→ 域8（预测系统）：每次上传后更新预测分
```

#### 关键规则

```
标"对"：只更新last_active，不改level（上传≠验证）
标"错"：不立即降级，等诊断定位后精确降级
         3天未诊断→默认降到L3
训练中做错：系统知道在哪个Step失败→可立即精确降级
```

---

### 域6：状态追踪引擎 ⚙️

> **职责**：所有标签的升降级规则中枢，是唯一修改掌握度的权威来源

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 标签更新算法 | §29 | 5种触发事件的标签更新规则 |
| 遗忘保护策略 | §29(部分) | 乐观为主：只有做错才降级，时间不降级 |
| 不稳定标记 | §29, §36 | recent_results中既有对又有错→is_unstable=true |
| AI决策逻辑 | §29(部分) | 纯标签推导：从没学过/退步了/很久没碰/可能遗忘/稳定掌握 |

#### 标签更新触发表（核心规则引擎）

| 触发事件 | 对Model的影响 | 对KnowledgePoint的影响 |
|---------|-------------|---------------------|
| 训练做对 | 按Step精确升级（可跨级） | 按层验证升级 |
| 训练做错 | 按Step精确降级（下限L1） | 按失败层降级 |
| 上传标对 | last_active更新，level不变 | last_active更新 |
| 上传标错 | 暂不降级，等诊断后精确降 | last_active更新 |
| 快检结果 | 识别对→不改level；识别错→降到L1 | — |
| AI诊断完成 | 按四层定位更新level | 如诊断出缺口→更新level |
| 审题训练 | — | — (只更新reading_accuracy) |

#### 数据流

```
此域是数据写入的中枢：

被谁触发（读来源事件）：
← 域3（模型训练）：训练结果
← 域2（知识点学习）：检测结果
← 域4（AI诊断）：诊断结论
← 域5（上传）：上传标注

写入目标：
→ D3.Model：current_level, peak_level, is_unstable, recent_results, error_count, correct_count
→ D2.KnowledgePoint：current_level, peak_level, error_count, correct_count
→ D1.Student：reading_accuracy, total_closures
```

#### 遗忘保护策略

```
0-14天：无动作，乐观信任 → ❌不降级
14天：标注"建议复习"→ 推荐列表插入 → ❌不降级
28天：标注"可能遗忘"→ 更积极推送 → ❌仍不降级
做错了：根据实际错误降级 → ✅降级

核心原则：只有做错才降级，时间不降级
```

---

### 域7：闪卡与记忆系统 🃏

> **职责**：间隔复习巩固，是学习链路的"保护层"
> **特点**：数据上相对独立，主要被其他域单向写入

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 9类卡片体系 | §15 | 模型6种(识别/决策/步骤/陷阱/公式/变式) + 知识点3种(概念/条件/辨析) |
| SM-2间隔复习算法 | §15 | ease_factor + interval + repetitions |
| 自动生成规则 | §15 | 知识点学完→生成概念卡/条件卡/辨析卡；模型每Step→对应闪卡 |

#### 核心数据模型

```
Flashcard（D5）：
├── card_type: 9种之一
├── front_content / back_content
├── source_model_id / source_kp_id  // 来源
├── ease_factor: float (初始2.5, 最小1.3)
├── interval: int (天数)
├── repetitions: int (连续答对次数)
└── next_review_date: timestamp
```

#### 数据流

```
写入来源（谁生成闪卡）：
← 域2（知识点学习）：5步完成后 → 自动生成概念卡/条件卡/辨析卡
← 域3（模型训练）：每Step完成后 → 自动生成识别卡/决策卡/步骤卡/陷阱卡/变式卡
← 域3（易混对比表）：展示后 → 自动生成辨析卡

内部更新：
用户复习时 → SM-2算法更新 ease_factor/interval/repetitions

特点：
- 闪卡复习不计入"闭环数"（独立统计在"记忆"Tab）
- 闪卡不触发模型/知识点的Level变更
- 闪卡不触发快检
- 是单向消费：只接收其他域的输出，不影响其他域的状态
```

---

### 域8：预测系统 📊

> **职责**：告诉学生"如果现在考高考能得多少分"，驱动个性化路径

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 预测算法(V1) | §52 | 题号→所需模型/知识点→Level转概率→木桶原则→加权求和 |
| 预测中心展示 | §28 | 预测总分+趋势图+学习路径推荐 |
| 高考Tab叠加预测 | §28 | 每个题号聚合页显示"预测得分X/Y分" |
| 校准方法 | §52 | 用真实考试成绩回归调参 |

#### 预测公式数据流

```
输入数据（全部读取，不写入）：
├── D6.question_map: {题号 → [所需模型, 所需知识点, 满分]}  ← 教研预设
├── D3.Model: {model_id → current_level, is_unstable, last_error_subtype}  ← 域6维护
├── D2.KnowledgePoint: {kp_id → current_level}  ← 域6维护
├── D1.exam_strategy: {题号 → attitude}  ← 域1生成
└── D4.pending_diagnosis_count  ← 域5维护

计算过程：
每题得分 = min(所有模型概率, 所有知识点概率) × 满分
├── 模型概率 = level_to_prob[level] × (0.7 if unstable) ± 5%(subtype微调)
└── 知识点概率 = level_to_prob[level]（不设unstable折扣）
总分 = Σ每题得分 × 未诊断折扣(max(0.90, 1-pending×0.02))

输出：
→ D1.Student.predicted_score
→ D1.Student.last_prediction_time
```

#### 触发时机

```
- 完成一轮模型训练后
- 做完一套卷子后
- 周复盘时
- 上传标注后（批量更新）
```

---

### 域9：推荐与复盘 🎯

> **职责**：告诉学生"下一步该做什么"，闭环中的"复盘升级"环节

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 主页推荐排序算法 | §10 | 候选池4来源 × 4级优先级 |
| 首周冷启动推荐 | §10 | 注册后7天内，穿插未测模型的快检 |
| 快速开始 | §21 | 一键进入最高优先级任务 |
| 周复盘页 | §31, §54 | AI叙事+Level变化表+下周行动建议 |
| 延时复测等待期利用 | §50 | L4等待复测期间→推同族模型/其他薄弱模型 |
| 每日闭环定义 | §11 | 错题分析/刷题算闭环，知识点学习不算 |
| 粗心消杀触发 | §22 | 周末推送+主动入口 |

#### 推荐排序算法

```
候选池来源：
1. 待诊断错题（D4.diagnosis_status=pending）
2. 不稳定模型（D3.is_unstable=true）
3. 久未练习（D3.last_active > 14天 或 D2.last_active > 14天）
4. AI诊断推荐的训练/补强

排序优先级（高→低）：
1. 待诊断错题（最新优先）
2. 不稳定模型（对预测分影响大的优先）
3. 久未练习 && 对预测分影响大的
4. 周复盘Top 3推荐项
```

#### 数据依赖

```
读取（不写入任何数据）：
← D4.Question：待诊断错题列表
← D3.Model：is_unstable, last_active, current_level
← D2.KnowledgePoint：last_active, current_level
← D1.Student：target_score, exam_strategy, predicted_score
← D6.RegionalTemplate：exam_strategy中的🔴模型列表
← D8（预测系统）：预测分变化、分数影响映射

输出：
→ 排序后的推荐列表（展示用，不修改底层数据）
→ 周复盘AI叙事（~0.05元/次）
```

---

### 域10：路由调度中枢 🔀

> **职责**：决定学生从哪一步开始训练，是连接"诊断→训练"的关键桥梁
> **特点**：纯规则层（if-else），0成本，不调大模型

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 六步闭环架构 | §16 | 发现→诊断→训练→验证→巩固→复盘 |
| 系统两层架构 | §16 | 路由层(纯规则,0成本) + 对话层(大模型) |
| 知识点5步路由规则 | §16 | 根据peak_level/current_level/conclusion_level决定入口Step |
| 模型6步路由规则 | §16 | 4个优先级：从没学过/做错题分流/久未练习/正常路由 |
| 跨模型依赖处理 | §51 | Step 1识别失败→检查前置依赖→提示/跳转（最多嵌套1层） |
| 热身机制 | §35 | 不做，现有路由自动降级=隐式热身 |

#### 路由决策输入

```
知识点路由读取：
← D2.KnowledgePoint：peak_level, current_level, conclusion_level, last_active

模型路由读取（按优先级匹配）：
← D3.Model：peak_level, current_level, last_active
← D4.Question.diagnosis_result：错误子类（做错题分流场景）
← D1.Student.reading_accuracy：审题正确率（决定是否插入审题训练）
← D6.model_prerequisites：前置依赖表

路由输出：
→ 域2（知识点学习）：从Step几开始
→ 域3（模型训练）：从Step几开始 + 是否插入审题训练
```

#### 核心原则

```
- Level本身编码了瓶颈层：L1=Step1, L2=Step2, L3=Step3-5
- 不需要weak_step字段（旧版已废弃）
- 路由层只读标签、不改标签（改标签是域6的职责）
```

---

### 域11：架构与导航 🏗️

> **职责**：产品骨架——Tab结构、页面清单、版本范围、约束条件

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 三Tab架构（全局页） | §1 | 知识点 / 模型方法 / 高考卷子视角 |
| 强制三级结构 | §1 | 所有学科、所有Tab统一L1→L2→L3 |
| 高考卷子Tab | §9 | 题型→题号→具体题目列表，支持上传整张卷子 |
| 底部导航栏 | §17 | 主页 / 全局 / 记忆 / 社区 / 我的 |
| 完整页面清单 | §44 | 6个一级页面 + 13个二级页面 + 5个弹窗 + 3个注册页 |
| 主页结构 | §10(部分) | "+"按钮、推荐区、快速开始、预测入口、今日数据 |
| V1版本范围 | §13 | 物理+数学，全部章节 |
| 约束条件 | §4 | 仅AI提示词，不涉及图片/视频生成 |
| 知识点与模型关系 | §2(部分) | 双向关联：related_models[] ↔ required_knowledge_points[] |
| 跨章节模型处理 | §1(部分) | 在所有相关章节都出现，数据只存一份 |
| 刷题中知识点角色 | §20 | 不单独出知识点题，仅标签辅助 |
| 模型Tab L3交互 | §24 | 点击子问题类型→跳到模型详情页锚点 |
| 模型族设计 | §32 | 不引入model_family标签，保持独立节点 |
| 掌握度稳定性判定 | §36(部分) | 变式题=防假会机制，不额外加解释环节 |
| 跨模型错误模式识别 | §41 | V1不做自动分析，靠周复盘+高考视角天然覆盖 |

#### 数据关联

```
此域主要定义结构，不直接读写业务数据
唯一的数据关联：
- 三Tab中知识点Tab和模型Tab的Level 1共用同一分类（按章）
- 高考卷子Tab的Level 1按题型分
- 知识点与模型的双向关联（related_models[] ↔ required_knowledge_points[]）
```

---

### 域12：商业与运营 💰

> **职责**：定价、分销、社区、状态可视化展示

#### 包含的功能模块

| 模块 | 原文Section | 核心内容 |
|------|-----------|---------|
| 商业模式与定价 | §55 | 首次诊断69-99元 / 基础500元/月 / 完整1000元/月 |
| 分销渠道策略 | §56 | 一对一老师→家长口碑→教育社群 |
| 品牌概念 | §56 | 四层诊断、卷面策略、一眼看进步 |
| 社区Tab | §25 | 我的需求/新功能加速/改版建议 |
| 状态可视化 | §48 | 卷面热力图（概览层）+ 模型漏斗图（详情层） |
| V1上线范围 | §53 | 天津+另一城市，5-6周节奏 |

#### 500 vs 1000元/月功能拆分

```
500元/月 = "看得清"（主要依赖域6/8/9/11，AI成本低）：
├── 卷面热力图 + 模型漏斗图（域12-可视化 ← 域6标签）
├── 上传 → 自动标签（域5）
├── 推荐"你该练什么"（域9）
├── 周复盘报告（域9）
├── 闪卡复习（域7）
├── 预测分数（域8）
└── AI成本：~0.1元/题上传识别 + ~0.05元/周复盘

1000元/月 = "看得清 + 练得准"（新增域2/3/4，AI成本高）：
├── 500的一切
├── AI诊断对话（域4，~0.3-0.5元/次）
├── 6步模型训练（域3，~0.4-0.6元/次）
├── 知识点学习流（域2，~0.3-0.5元/次）
└── AI成本：活跃用户~30-50元/月
```

---

## 二、功能域之间的数据关联全景图

### 数据写入权限矩阵

> 谁有权修改哪个数据实体（写入权限必须明确，避免冲突）

| 数据实体 | 写入方 | 写入场景 |
|---------|--------|---------|
| D1.Student基础信息 | 域1 | 注册/修改目标分 |
| D1.Student.predicted_score | 域8 | 预测算法输出 |
| D1.Student.reading_accuracy | 域6 | 审题训练后更新 |
| D1.Student.closures | 域6 | 每次闭环后更新 |
| D2.KnowledgePoint.current_level | **域6（唯一）** | 统一标签更新算法 |
| D2.KnowledgePoint.last_active | 域5, 域6 | 上传/训练后更新 |
| D3.Model.current_level | **域6（唯一）** | 统一标签更新算法 |
| D3.Model.is_unstable | 域6 | 每次更新recent_results后检查 |
| D3.Model.next_retest_date | 域3 | L4后安排延时复测 |
| D4.Question（新建） | 域5 | 上传时创建 |
| D4.Question.diagnosis_result | 域4 | 诊断完成时写入 |
| D5.Flashcard（新建） | 域2, 域3 | 学习/训练完成后自动生成 |
| D5.Flashcard（更新） | 域7 | SM-2算法更新 |
| D6.RegionalTemplate | 教研团队 | 线下维护 |

### 域间数据流向图

```
               ┌─────────────────────────────────────────────────────────┐
               │                    教研预设数据                          │
               │  D6: 地区模板/题号映射/易混组/前置依赖/模型关联           │
               └──────┬──────────┬──────────┬──────────┬────────────────┘
                      │          │          │          │
                      ▼          ▼          ▼          ▼
    ┌──────┐    ┌──────────┐  ┌────────┐  ┌────────┐  ┌──────────┐
    │ 域1  │    │   域10   │  │  域3   │  │  域8   │  │   域9    │
    │注册  │───▶│ 路由调度  │  │模型训练│  │预测系统│  │推荐复盘   │
    │初始化│    └────┬─────┘  └───┬────┘  └────────┘  └──────────┘
    └──┬───┘         │            │            ▲            ▲
       │             │            │            │            │
       │     ┌───────┴────────────┤            │            │
       │     │                    │            │            │
       │     ▼                    ▼            │            │
       │  ┌──────┐          ┌──────────┐       │            │
       │  │ 域2  │          │   域6    │───────┘            │
       │  │知识点│◀────────▶│状态追踪  │───────────────────┘
       │  │学习  │          │ 引擎     │
       │  └──┬───┘          └──┬───────┘
       │     │                 ▲
       │     │                 │
       │     ▼                 │
       │  ┌──────┐          ┌──────┐       ┌──────┐
       │  │ 域7  │          │ 域4  │◀──────│ 域5  │
       │  │闪卡  │          │AI诊断│       │上传  │
       │  │记忆  │          └──────┘       └──────┘
       │  └──────┘
       │
       └──▶ D1.Student（exam_strategy, 三维画像）
            D3.Model × N（初始Level）
```

### 关键数据流路径

#### 路径A：错题→诊断→训练→验证→巩固（核心闭环）

```
域5（上传标错）
  → D4.Question创建 + diagnosis_status=pending
  → D3.Model.last_active更新

域9（推荐"待诊断错题"）
  → 学生点击进入

域4（AI诊断5轮）
  → 定位：建模层/列式层/执行层/粗心
  → D4.diagnosis_result写入
  → D3.Model.current_level精确降级

域10（路由调度）
  → 读D3.current_level → 决定从Step几开始

域3（模型训练）或 域2（知识点学习）
  → 训练过程

域6（状态更新）
  → 训练结果 → D3/D2.current_level升级
  → D3.recent_results更新 → is_unstable检查

域7（闪卡生成）
  ← 训练完成 → 自动生成对应闪卡

域8（预测更新）
  ← D3/D2 Level变化 → 重算predicted_score
```

#### 路径B：注册→策略→诊断→推荐（冷启动）

```
域1（注册）
  → Step 1: D1.target_score + D1.region_id
  → Step 2: D6读取 → 生成D1.exam_strategy
  → Step 3: AI诊断 → D3.Model × N 初始Level

域8（首次预测）
  ← D3 + D2 + D6 → D1.predicted_score

域9（首周推荐）
  ← D1.exam_strategy中🔴模型
  ← D3中peak_level=0的模型
  → 穿插未测模型的快检
```

#### 路径C：延时复测→降级/升级（长期保持）

```
域3（延时复测到期）
  → D3.next_retest_date到期 → 进入域9推荐列表
  → 学生进入复测 → 变式题

域6（状态更新）
  → 通过 → D3.current_level维持/升到L5
  → 失败 → D3精确降到出错的层 → 重新进入训练闭环
```

---

## 三、功能域的开发优先级建议

### 按依赖关系排序的开发层次

```
第1层（基础设施 - 必须先做）
├── 域11：架构与导航（页面骨架、Tab结构）
├── 域6：状态追踪引擎（标签更新算法 - 所有功能的基础）
└── 域1：注册与初始化（没有注册就没有用户）

第2层（核心价值 - 最小可用产品）
├── 域5：错题与上传（数据入口，没有上传就没有数据）
├── 域4：AI诊断（核心卖点C - 四层诊断）
├── 域10：路由调度（连接诊断→训练的桥梁）

第3层（训练闭环 - 完整体验）
├── 域3：模型训练（6步专项）
├── 域2：知识点学习（5步流程）
├── 域7：闪卡与记忆（巩固层）

第4层（增值功能 - 竞争力）
├── 域8：预测系统（核心卖点B - 分数预测）
├── 域9：推荐与复盘（核心卖点 - 教练智能）
├── 域12：商业与运营（变现、可视化、社区）
```

### 500元/月 vs 1000元/月的功能域拆分

```
500元/月需要的功能域：
├── 域11（架构导航）✅ 完整
├── 域6（状态引擎）✅ 完整
├── 域1（注册初始化）✅ 完整
├── 域5（上传体系）✅ 完整
├── 域7（闪卡记忆）✅ 完整
├── 域8（预测系统）✅ 完整
├── 域9（推荐复盘）✅ 完整
├── 域12（可视化）✅ 完整
├── 域10（路由调度）⚠️ 部分（简化路由，不需要完整6步路由）
└── 域4（AI诊断）❌ 不含

1000元/月额外需要的功能域：
├── 域4（AI诊断）✅ 完整
├── 域3（模型训练）✅ 完整
├── 域2（知识点学习）✅ 完整
└── 域10（路由调度）✅ 完整版
```

---

## 四、原文Section与功能域的映射表

> 便于对照原文查看完整细节

| 原文Section | 功能域 | 核心关联数据 |
|------------|--------|------------|
| §1 三Tab架构 | 域11-架构 | — |
| §2 知识点与模型关系+AI诊断分流 | 域4-诊断 + 域11-架构 | D3, D2, D4 |
| §3 知识点学习流程 | 域2-知识点 | D2 |
| §4 约束条件 | 域11-架构 | — |
| §5 保留核心设计(闭环/训练/闪卡) | 域3-模型 + 域7-闪卡 + 域5-错题 | D3, D5 |
| §6 知识点掌握度 | 域2-知识点 | D2 |
| §7 概念检测触发时机 | 域2-知识点 | D2 |
| §8 模型掌握度 | 域3-模型 | D3 |
| §9 高考卷子Tab | 域11-架构 | D4, D6 |
| §10 主页结构 | 域9-推荐 + 域11-架构 | D3, D2, D1 |
| §11 每日闭环定义 | 域9-推荐 | D1 |
| §12 模型详情页 | 域3-模型 | D3, D2 |
| §13 V1版本范围 | 域11-架构 | — |
| §14 注册流程 | 域1-注册 | D1, D3, D6 |
| §15 闪卡系统 | 域7-闪卡 | D5 |
| §16 六步闭环+路由规则 | 域10-路由 | D2, D3 |
| §17 Tab改名 | 域11-架构 | — |
| §18 知识点详情页 | 域2-知识点 | D2 |
| §19 模型训练交互细化 | 域3-模型 | D3 |
| §20 刷题中知识点角色 | 域11-架构 | — |
| §21 快速开始 | 域9-推荐 | D3, D2 |
| §22 粗心消杀 | 域9-推荐 | D4 |
| §23 AI诊断轮数 | 域4-诊断 | — |
| §24 模型Tab L3交互 | 域11-架构 | — |
| §25 社区Tab | 域12-商业 | — |
| §26 一级/二级结论 | 域2-知识点 | D2 |
| §27 预测系统 | 域8-预测 | D1, D3, D2, D6 |
| §28 分数预测展示 | 域8-预测 | D1 |
| §29 后端标签体系 | 域6-状态引擎 + 域5-上传 | D2, D3, D1 |
| §30 统一上传体系 | 域5-上传 | D4 |
| §31 周复盘页 | 域9-推荐 | D3, D2, D1 |
| §32 模型族设计 | 域11-架构 | — |
| §33 过程拆分与主语 | 域3-模型 | D3 |
| §34 "不敢写"检测 | 域3-模型 | — |
| §35 热身机制 | 域10-路由 | — |
| §36 掌握度稳定性判定 | 域6-状态引擎 + 域11-架构 | D3 |
| §37 易混模型对比表 | 域3-模型 | D3(confusion_groups) |
| §38 审题训练 | 域3-模型 | D1(reading_accuracy) |
| §39 粗心细分记录 | 域4-诊断 | D4 |
| §40 一级/二级结论学习路径 | 域2-知识点 | D2(conclusion_level) |
| §41 跨模型错误模式识别 | 域11-架构 | — |
| §42 AI人格设定 | 域4-诊断 | — |
| §43 快检题设计 | 域3-模型 | D3 |
| §44 完整页面清单 | 域11-架构 | — |
| §45 AI提示词变量参考表 | 域4-诊断（参考表） | 所有 |
| §46 地区卷面结构模板 | 域1-注册 | D6 |
| §47 上传考试卷子 | 域5-上传 | D4, D6 |
| §48 状态可视化 | 域12-商业 | D3, D2, D1, D6 |
| §49 未诊断超时处理 | 域5-上传 | D3, D4 |
| §50 延时复测等待期利用 | 域9-推荐 | D3, D6 |
| §51 跨模型依赖处理 | 域10-路由 | D3, D6 |
| §52 预测分数算法 | 域8-预测 | D1, D2, D3, D6 |
| §53 V1上线范围 | 域12-商业 | — |
| §54 周复盘数据规格 | 域9-推荐 | D1, D2, D3 |
| §55 商业模式与定价 | 域12-商业 | — |
| §56 分销渠道策略 | 域12-商业 | — |
| 审计补充-数据模型 | 域6-状态引擎 | D1, D2, D3, D4, D6 |

---

## 五、关键结论

### 1. 最核心的枢纽域：域6（状态追踪引擎）

域6是整个系统的"心脏"——所有功能域产生的学习行为，最终都通过域6的标签更新算法写入掌握度。如果域6的规则出错，整个系统的诊断、路由、预测、推荐全部会出问题。

**建议**：域6的规则引擎必须有完善的单元测试覆盖。

### 2. 最独立的域：域7（闪卡与记忆）

域7只被其他域单向写入（生成闪卡），不影响任何其他域的数据状态。可以独立开发和测试。

**建议**：域7可以最早上线，作为低风险的独立模块。

### 3. 耦合度最高的三角：域4（诊断）↔ 域6（状态）↔ 域10（路由）

这三个域形成了一个紧密的三角关系：
- 域4的诊断结果 → 通过域6写入Level
- 域6的Level → 被域10读取决定路由入口
- 域10的路由结果 → 决定进入域3/域2的哪一步 → 产生训练结果 → 回到域6更新

**建议**：这三个域必须一起设计、一起测试，不能分开做。

### 4. 数据入口只有一个：域5（上传）

所有学习数据的源头都是"学生做了题+标了对错"。没有域5的上传，域4/6/8/9都无法运转。

**建议**：上传体验的流畅度直接决定产品活跃度，是优先级最高的UX投入。

### 5. 付费转化的关键域：域1（注册） + 域12（可视化）

首次诊断报告（域1的输出）+ 卷面热力图/模型漏斗图（域12的展示）是让家长付费的第一印象。

**建议**：这两个域的视觉设计投入要最大。
