# EchoMind Flutter 22 个页面自动截图指南

## 原理

Flutter 的 `integration_test` 框架可以在真实设备/桌面窗口中启动完整 App，通过 `GoRouter.go()` 程序化导航到每个页面，再将渲染帧导出为 PNG 文件。

核心流程：启动 App → 注入假 token 绕过登录守卫 → 逐页导航 → 逐页截图保存。

## 前置条件

- Flutter SDK 已安装且 `flutter doctor` 无报错
- Windows 桌面开发已启用（`flutter config --enable-windows-desktop`）
- 当前目录为 `flutter前端/echomind_app/`

## 一键运行

```bash
cd "D:\AI\AI+high school homework\EchoMind-AI_Error_Tracker\flutter前端\echomind_app"
flutter test integration_test/screenshot_22_pages_test.dart -d windows
```

运行结束后，22 张 PNG 截图自动保存到：

```
docs/第五阶段_前后端对接与UI分支合并/21个flutter页面的截图/
├── 01_login_page.png
├── 02_register_page.png
├── 03_register_strategy_page.png
├── 04_home_page.png
├── 05_profile_page.png
├── ...
└── 22_upload_history_page.png
```

## 截图清单（22 个页面）

| 编号 | 文件名 | 对应页面 | 路由 |
|------|--------|---------|------|
| 01 | 01_login_page.png | 登录页 | /login |
| 02 | 02_register_page.png | 注册页 | /register |
| 03 | 03_register_strategy_page.png | 注册策略页 | /register-strategy |
| 04 | 04_home_page.png | 首页 | / |
| 05 | 05_profile_page.png | 个人中心 | /profile |
| 06 | 06_community_page.png | 社区 | /community |
| 07 | 07_knowledge_learning_page.png | 知识学习 | /knowledge-learning |
| 08 | 08_knowledge_detail_page.png | 知识详情 | /knowledge-detail/:id |
| 09 | 09_global_knowledge_page.png | 全局知识 | /global-knowledge |
| 10 | 10_ai_diagnosis_page.png | AI诊断 | /ai-diagnosis |
| 11 | 11_prediction_center_page.png | 预测中心 | /prediction-center |
| 12 | 12_model_training_page.png | 模型训练 | /model-training |
| 13 | 13_model_detail_page.png | 模型详情 | /model-detail/:id |
| 14 | 14_global_model_page.png | 全局模型 | /global-model |
| 15 | 15_global_exam_page.png | 全局考试 | /global-exam |
| 16 | 16_question_detail_page.png | 题目详情 | /question-detail/:id |
| 17 | 17_question_aggregate_page.png | 题目聚合 | /question-aggregate |
| 18 | 18_flashcard_review_page.png | 闪卡复习 | /flashcard-review |
| 19 | 19_weekly_review_page.png | 周报 | /weekly-review |
| 20 | 20_memory_page.png | 记忆中心 | /memory |
| 21 | 21_upload_menu_page.png | 上传菜单 | /upload-menu |
| 22 | 22_upload_history_page.png | 上传历史 | /upload-history |

## 技术实现说明

### 截图脚本位置

```
flutter前端/echomind_app/integration_test/screenshot_22_pages_test.dart
```

### 工作原理

1. 使用 `IntegrationTestWidgetsFlutterBinding` 启动真实渲染引擎
2. 通过 `SharedPreferences.setMockInitialValues` 注入/清除 `auth_token`
   - 登录页、注册页：清除 token，触发路由守卫重定向到 `/login`
   - 其余 20 个页面：注入假 token，绕过登录守卫
3. 设置视口为 390x844（iPhone 14 尺寸），`devicePixelRatio = 1.0`
4. 通过 `appRouter.go(route)` 程序化导航到目标页面
5. `pumpAndSettle` 等待动画和异步渲染完成
6. 从 `RenderView` 的 `OffsetLayer` 导出 PNG 像素数据并写入文件

### 带参数的路由处理

部分页面需要路径参数或查询参数，测试中使用 `demo` 作为占位 ID：

| 页面 | 测试路由 |
|------|---------|
| 知识详情 | `/knowledge-detail/demo` |
| 知识学习 | `/knowledge-learning?kpId=demo&source=self_study` |
| 模型详情 | `/model-detail/demo` |
| 模型训练 | `/model-training?modelId=demo&source=self_study` |
| 题目详情 | `/question-detail/demo` |

这些页面会显示空数据或加载态，截图反映的是 UI 骨架布局。
