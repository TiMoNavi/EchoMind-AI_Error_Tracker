# 教育数据需求清单

> 来源：T003 后端 API 审查 + T009 前端硬编码扫描（claude-3, 2026-02-24）
> 说明：以下所有条目均为系统中**需要外部提供教育领域数据/算法规则**的缺口，开发团队不自行编写教育内容。
>
> **Part A（需求 1-6）：** 后端 API 层缺口
> **Part B（需求 7-10）：** 前端硬编码教育内容（需替换为 API 数据）

---

## 需求 1：Student 四维能力评估算法

**涉及字段（Student 表）：**
- `formula_memory_rate` — 公式记忆率（当前默认 0，无更新逻辑）
- `model_identify_rate` — 模型识别率（当前默认 0，无更新逻辑）
- `calculation_accuracy` — 计算准确率（当前默认 0，无更新逻辑）
- `reading_accuracy` — 审题准确率（当前默认 0，无更新逻辑）

**被引用位置：**
- `dashboard_service.py` → GET /api/dashboard 返回给前端展示
- `prediction_service.py` → GET /api/prediction/score 的 score_path 部分
- `weekly_review_service.py` → GET /api/weekly-review 的 dashboard_stats 部分

**需要您提供：**
1. 这四个维度的**计算公式/规则**（基于哪些原始数据？如何聚合？）
2. 每个维度的**目标值**（当前 prediction_service 硬编码为 0.9/0.85/0.95/0.9）
3. **更新触发时机**（每次上传错题后？每日定时？）

---

## 需求 2：预测分数算法

**涉及字段（Student 表）：**
- `predicted_score` — 预测分数（当前为 NULL，无任何写入逻辑）

**被引用位置：**
- `dashboard_service.py` → GET /api/dashboard
- `prediction_service.py` → GET /api/prediction/score

**需要您提供：**
1. predicted_score 的**计算公式**（基于掌握度？四维能力？历史正确率？）
2. 分数范围（满分多少？物理/数学是否不同？）
3. 更新频率

---

## 需求 3：分数趋势数据

**涉及位置：**
- `prediction_service.py` 第 40 行：`trend_data=[]` 硬编码为空列表

**Schema 定义：**
```python
class TrendPoint(BaseModel):
    date: str    # 日期
    score: float # 分数
```

**需要您提供：**
1. trend_data 的**数据来源**（是真实考试成绩？还是系统预测的历史分数？）
2. 时间粒度（每天？每周？每次考试？）
3. 如果是考试成绩，需要提供考试数据的录入方式

---

## 需求 4：考试记录数据

**涉及位置：**
- `exam_service.py` 第 13 行：`get_recent_exams()` 直接 `return []`（注释："暂无独立考试表"）

**Schema 定义：**
```python
class ExamItem(BaseModel):
    # 需要确认字段结构
```

**需要您提供：**
1. 是否需要独立的考试表？还是从 Question 数据聚合？
2. 考试记录包含哪些字段？（考试名称、日期、总分、得分、科目等）
3. 考试数据如何录入？（学生手动输入？批量导入？）

---

## 需求 5：周报分数变化

**涉及位置：**
- `weekly_review_service.py` 第 47 行：`score_change=0.0` 硬编码

**需要您提供：**
1. score_change 的**计算方式**（本周预测分 - 上周预测分？本周考试分 - 上周考试分？）
2. 如果依赖考试数据，则与需求 4 关联

---

## 需求 6：错题诊断结果数据结构

**涉及字段（Question 表）：**
- `diagnosis_status` — 诊断状态（默认 "pending"）
- `diagnosis_result` — 诊断结果（JSONB，当前无写入逻辑）
- `primary_model_id` — 主要物理模型 ID（上传时可能为 None）
- `related_kp_ids` — 关联知识点 ID 列表（上传时可能为 None）

**需要您提供：**
1. diagnosis_result 的 **JSON 结构定义**（包含哪些字段？错误类型编码？）
2. primary_model_id 和 related_kp_ids 是**人工标注**还是 **AI 自动识别**？
3. 如果是 AI 识别，对接哪个服务？接口规范？

---

## 交付格式建议

以上每个需求，建议您以以下格式提供：

```
需求编号: X
计算规则/公式: （文字描述或数学公式）
输入数据: （需要哪些原始数据）
输出格式: （字段类型、取值范围）
更新触发: （什么时候计算/更新）
示例: （一个具体的计算示例）
```

我们收到后会直接转化为代码实现。

---
---

# Part B：前端硬编码教育内容

> 以下模块中存在硬编码的教育内容（对话、题目、分析等），需要替换为从 API 获取的真实数据。
> 每个需求列出：当前硬编码内容、所在文件、需要提供的数据格式和数量。

---

## 需求 7：AI 诊断对话内容

**涉及文件：**
- `echomind_app/lib/features/ai_diagnosis/widgets/main_content_widget.dart`

**当前硬编码内容（3 类）：**

### 7.1 题目引用信息
```
"引用题目：第5题 — 等量异种点电荷电场分析"
```
- 数据类型：题目编号 + 题目标题
- 格式：`{ question_number: int, title: string }`
- 来源：应从 Question 表 + diagnosis_result 动态获取

### 7.2 AI 诊断对话（3 轮）
```
AI: "根据你的作答记录，这道题你选了B，正确答案是ACD。
     主要问题：1. 对中垂线上电势分布理解有误 2. 电场强度变化趋势判断错误
     关联薄弱点：库仑定律适用条件、电场叠加原理"
学生: "那中垂线上电势为什么相等？"
AI: "等量异种电荷的中垂线是等势面（电势为零）。因为中垂线上任意一点到+Q和-Q的距离相等，
     而它们产生的电势大小相等、符号相反，叠加后为零。"
```
- 数据类型：多轮对话消息列表
- 格式：`[{ role: "ai"|"student", content: string }]`
- 数量需求：每道错题对应一组诊断对话（3-5 轮），需覆盖所有已录入错题

### 7.3 诊断结论 + 推荐训练
```
"建议加强'电场叠加原理'模型训练"
```
- 数据类型：诊断结论文本 + 推荐模型 ID
- 格式：`{ conclusion: string, recommended_model_id: string }`
- 来源：应由 AI 诊断服务生成，写入 Question.diagnosis_result

---

## 需求 8：知识学习对话内容

**涉及文件：**
- `echomind_app/lib/features/knowledge_learning/widgets/learning_dialogue_widget.dart`
- `echomind_app/lib/features/knowledge_learning/widgets/step1_concept_present_widget.dart`
- `echomind_app/lib/features/knowledge_learning/widgets/step2-5` （当前为 Placeholder，待填充）

**当前硬编码内容（4 类）：**

### 8.1 教学对话（5 轮）
```
AI: "库仑定律和万有引力定律都是平方反比定律。我来考考你, 这两个公式有什么关键区别?"
学生: "库仑定律是关于电荷之间的, 万有引力是关于质量之间的"
AI: "对, 这是最基本的区别。现在更关键的一个区别: 库仑定律的适用条件是什么?"
学生: "需要是点电荷, 或者可以看成点电荷的"
AI: "很好! 准确地说, 库仑定律只适用于真空中两个静止点电荷之间的力。
     那么如果一个带电球壳内部有一个点电荷, 能直接用库仑定律吗?"
```
- 数据类型：多轮教学对话
- 格式：`[{ role: "ai"|"student", content: string }]`
- 数量需求：每个知识点对应 5 个步骤的对话内容，当前种子数据有 10 个知识点

### 8.2 快速选项（选择题式交互）
```
选项A: "能, 球壳可以看成点电荷"
选项B: "不能, 这不满足适用条件"
选项C: "不确定, 再解释一下"
```
- 数据类型：选择题选项列表
- 格式：`[{ text: string, is_correct: bool }]`
- 数量需求：每轮对话中的关键节点需要 2-4 个选项

### 8.3 概念对比表
```
|          | 库仑定律       | 万有引力       |
|----------|---------------|---------------|
| 作用对象  | 带电体         | 有质量的物体    |
| 方向     | 吸引或排斥      | 只有吸引       |
| 适用条件  | 真空+点电荷     | 任意两物体      |
```
- 数据类型：对比表格
- 格式：`{ headers: [string], rows: [{ label: string, values: [string] }], highlight_column?: int }`
- 数量需求：涉及易混淆概念的知识点各需 1 张对比表

### 8.4 步骤标题（5 步流程）
```
['概念呈现', '理解检查', '辨析训练', '实际应用', '概念检测']
```
- 说明：这 5 个步骤标题是学习流程框架，可保留为系统常量
- 但每个步骤的**具体内容**（step2-step5 当前为 Placeholder）需要教育数据填充

---

## 需求 9：模型训练对话内容

**涉及文件：**
- `echomind_app/lib/features/model_training/widgets/training_dialogue_widget.dart`
- `echomind_app/lib/features/model_training/widgets/step1_identification_training_widget.dart`
- `echomind_app/lib/features/model_training/widgets/step2-6` （当前为 Placeholder，待填充）

**当前硬编码内容（3 类）：**

### 9.1 训练对话（5 轮）
```
AI: "上一步你成功识别了板块运动模型。现在, 面对板块运动题, 你的第一步分析是什么?"
学生: "先分析两个物体各自受力"
AI: "对! 分别对物块和木板进行受力分析。那么物块受几个力? 分别是什么?"
学生: "物块受重力、支持力和摩擦力, 三个力"
AI: "正确。接下来关键的一步: 你怎么判断物块和木板之间的相对运动状态? 以及什么时候两者达到共速?"
```
- 数据类型：多轮训练对话
- 格式：`[{ role: "ai"|"student", content: string }]`
- 数量需求：每个物理模型对应 6 个步骤的训练对话，当前种子数据有 9 个模型

### 9.2 快速选项
```
选项A: "比较两个物体的加速度"
选项B: "用相对速度判断"
选项C: "不确定"
```
- 数据类型：选择题选项列表
- 格式：`[{ text: string, is_correct: bool }]`
- 数量需求：每轮训练对话的关键决策点需要 2-4 个选项

### 9.3 步骤标题（6 步流程）
```
['识别训练', '决策训练', '列式训练', '陷阱辨析', '完整求解', '变式训练']
```
- 说明：这 6 个步骤标题是训练流程框架，可保留为系统常量
- 但每个步骤的**具体内容**（step2-step6 当前为 Placeholder）需要教育数据填充

---

## 需求 10：社区需求模板数据

**涉及文件：**
- `echomind_app/lib/features/community/widgets/board_my_requests_widget.dart`

**当前硬编码内容：**

### 10.1 示例需求卡片（3 条）
```
1. 标题: "希望增加错题导出PDF功能"
   描述: "可以把错题按模型分组导出打印"
   票数: 23, 标签: ['功能请求', '3天前']

2. 标题: "数学也需要过程拆分训练"
   描述: "解析几何大题特别需要过程拆分"
   票数: 45, 标签: ['功能请求', '高票', '5天前']

3. 标题: "闪卡能不能支持手写公式"
   描述: "打字输入公式太麻烦了"
   票数: 8, 标签: ['体验优化', '1周前']
```
- 数据类型：社区需求列表
- 格式：`{ title: string, description: string, votes: int, tags: [string], created_at: datetime }`
- 说明：这些是 UI 演示数据，正式版应从社区 API 动态获取；如需保留示例数据，请确认内容是否合适

---
---

# 数据量汇总

| 需求 | 模块 | 数据类型 | 估算数量 |
|------|------|---------|---------|
| 7 | AI 诊断 | 诊断对话 + 结论 | 每道错题 1 组（3-5 轮） |
| 8 | 知识学习 | 教学对话 + 选项 + 对比表 | 10 知识点 × 5 步骤 |
| 9 | 模型训练 | 训练对话 + 选项 | 9 模型 × 6 步骤 |
| 10 | 社区 | 需求卡片模板 | 确认是否需要 |

**优先级建议：**
- P0（MVP 必需）：需求 7（诊断对话结构）、需求 8.1/9.1（至少各 1 个知识点/模型的完整对话）
- P1（演示完整）：需求 8.2-8.3 / 9.2（选项 + 对比表）
- P2（可后续补充）：需求 10（社区模板数据）
