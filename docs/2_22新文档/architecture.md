# 产品架构主控文档

> 创建日期：2026-02-20
> 目的：梳理所有维度、名词、关系，确定真相源 vs 派生视图，支撑可扩展架构设计
> 参考附录：v1.0.md（详细产品设计）、v1.1part.md（错误分析框架）

---

## Phase 0: 不变约束（已确认 2026-02-20）

| # | 约束 | 性质 |
|---|------|------|
| 1 | 后台算法只做 AI 提示词拼接，不涉及图片/视频生成 | 技术能力边界 |
| 2 | 题库是预设的（真题 + 本地可靠模拟卷，题库中可含图片） | 内容来源 |
| 3 | 知识点/模型讲解有预设好的 AI 工作流 | 内容来源 |
| 4 | 不做家长端（学生截图/H5分享页） | 产品范围 |
| 5 | 定价：500 诊断 + 3000 用到高考（每科目） | 商业模式 |
| 6 | V1 学科：物理 + 数学 | V1范围 |
| 7 | V1 地区：天津 + 另一个城市 | V1范围 |
| 8 | 目标用户：高三下学期 | 用户定位 |

### 产品原则（从对话中提炼，已确认 2026-02-20）

| # | 原则 | 你的原话 |
|---|------|---------|
| P1 | 系统能拿到什么数据，取决于你设计了什么"外化动作"（提问/选择/填空），学生不输入就没有数据 | "审题阶段学生在看，他没有动作，系统没有任何输入" |
| P2 | 错误类型必须可叠加，一次错误可以贴多个标签，标签可以一直加 | "甭管现在想的是啥，满足一个可叠加就行了" |
| P3 | 500 版 = 三个视角的静态快照（知识点掌握 + 考法掌握 + 分数预估） | "就是那三个视角的一个版本的静态的" |
| P4 | 3000 版 = 动态追踪（错题分析 + 定制训练 + 持续更新掌握度） | "追踪的过程…错题分析…定制训练…更新" |
| P5 | 用测试行为判断学生水平，不依赖学校层级等间接标签 | "学校不如测试靠谱…讲完能不能立刻写对" |
| P6 | 家长买的是确定性和安心，不是功能清单 | "带着预算跟分数和大概的时间，告诉大概能到什么样" |
| P7 | 原始事实（学生选了什么、用时多少、题目原文）和加工信号（掌握度、错因标签、推荐）必须分开存 | "没有AI介入的东西…加工出来的" |

### 协作原则（从对话中发现）

| # | 规则 |
|---|------|
| C1 | 不引入你没用过的新词；必须用时先用你的话解释，你确认了才定名字 |
| C2 | 问题用填空/选择格式，不用纯开放题 |
| C3 | 每个抽象概念必须配一个你教学经验里的具体例子 |

---

## Phase 1: 实体-字段全表（从 33 份教学记录提炼）

### 1.1 核心实体

| 实体 | 说明 | 举例 |
|------|------|------|
| 学生 | 使用系统的人 | 苏歆然、张可心、王浚、王雨萱 |
| 题目 | 一道具体的题 | 回旋加速器求频率、板块共速时间 |
| 知识点 | 基础概念/公式/定律 | 库仑定律、动能定理、v=v0+at |
| 考点/模型 | 一类题的通用解法 | 板块模型、回旋加速器、传送带、平抛 |
| 卷子结构 | 一张卷子的题型/题号/分值布局 | 天津物理卷：选择1-8/实验/大题1-3/选做 |
| Episode | 围绕一道题的教学/诊断片段 | "Episode 2：回旋加速器基础题" |
| Atom | 最小交互单元（一问一答一判） | 老师问→学生答→判 pass/fail/partial |
| 阶段 | Atom 发生在解题流程的哪一步 | 审题/过程/条件/列式/计算... |
| 错因标签 | 一次错误的具体原因（可叠加） | 过程边界混淆 + 符号丢失 |
| 教学动作 | 系统/老师做的事 | 追问/讲解/复做/确认/换卡 |

### 1.2 阶段表（从教学数据提取的 11 个阶段）

| 阶段 | 在测什么 | v1.0 中的对应 |
|------|---------|--------------|
| 审题 | 读懂题了吗、条件抓全了吗 | 步骤1 |
| 过程 | 能拆出几段运动、判断运动状态 | 步骤2 |
| 条件 | 知道公式/模型的适用前提吗 | 步骤3的一部分 |
| 主语 | 这个式子是对谁列的 | 步骤5 |
| 方向 | 力/速度/电流方向判断 | 步骤1+5 |
| 受力分析 | 力画全了吗、画对了吗 | 步骤1 |
| 列式 | 选对公式、列对方程 | 步骤4+6 |
| 计算 | 代数化简、数值计算 | 步骤7+8 |
| 检验 | 结果合理吗、单位对吗 | 步骤9 |
| 概念 | 基础概念理解 | 知识点相关 |
| 公式记忆 | 记住公式了吗 | 知识点相关 |

### 1.3 错因标签库（从教学数据提取，可叠加，可持续添加）

| 错因标签 | 属于哪个阶段 | 真实案例 |
|---------|------------|---------|
| 漏读条件 | 审题 | "光滑"没注意、"恰好"没看到 |
| 方向看反 | 审题 | 向左看成向右、角增大看成减小 |
| 过程数量错 | 过程 | 少拆一段运动、碰后还有运动没考虑 |
| 运动状态误判 | 过程 | 减速说成加速、匀速说成加速 |
| 适用条件不知 | 条件 | 有外力仍用动量守恒、不知"恰好"是使用√(gR)的前提 |
| 二级结论依赖 | 条件 | 只背结论不知一级公式推导、不知何时能用 |
| 公式对错对象 | 主语 | 对A列的力用到B身上、碰后质量用单体 |
| 整体隔离搞混 | 主语 | 隔离法时把另一物体的力丢了 |
| 公式选错路径 | 列式 | 从F=QE入手走不通、应从r=mv/BQ反推 |
| 过程边界混淆 | 列式 | 不同过程的量混在同一方程里 |
| 方程符号错 | 列式 | 动量守恒写减号、矢量式丢负号 |
| 代数化简错 | 计算 | 消元不彻底、平方展开出错 |
| 符号管理差 | 计算 | 同字母指代不同物理量、正负号丢失 |
| 单位换算粗心 | 计算 | 0.01kg写漏、科学计数法不规范 |
| 公式不完整 | 公式记忆 | V=AT缺V0、ΔΦ漏乘B |
| 公式名称混淆 | 公式记忆 | 电动势和场强都叫E分不清、洛伦兹力和安培力搞混 |
| 概念区分不清 | 概念 | 动量守恒≠动能守恒、路程≠位移、做功是过程量 |

### 1.4 Atom 字段表（最小记录单元 = 系统的真相源）

| 字段 | 类型 | 来源 | 是否真相源 |
|------|------|------|-----------|
| atom_id | ID | 系统生成 | — |
| episode_id | ID | 所属 Episode | — |
| stage | 枚举(11个) | 系统/教研预设 | 是（设计层面） |
| 问法 | 文本 | AI生成/教研预设 | 是 |
| 学生输出 | 文本/选项 | 学生输入 | 是 |
| 关键点 | 文本 | AI/教研标注 | 是 |
| 验证动作 | 枚举(追问/讲解/复做/确认/换卡) | 系统决策 | 是 |
| 本轮结论 | 枚举(pass/fail/partial) | AI判定 | 是 |
| 下一步 | 文本 | 系统决策 | 是 |
| 错因标签 | 标签集合(可叠加) | AI判定+教研预设 | 是（加工信号，但需存） |
| 用时(秒) | 数值 | 系统记录 | 是 |

### 1.5 Episode 字段表

| 字段 | 类型 | 说明 |
|------|------|------|
| episode_id | ID | 唯一标识 |
| student_id | ID | 哪个学生 |
| problem_id | ID/文本 | 哪道题 |
| episode_goal | 枚举(diagnose/teach/verify) | 这个片段的目的 |
| entry_stage | 阶段枚举 | 从哪个阶段开始 |
| card_path | 文本 | 走过了哪些阶段 |
| 错因派生 | 文本+标签集合 | 这个 Episode 的错误总结 |
| timestamp | 时间 | 什么时候发生的 |

### 1.6 四种问法类型（教学动作的核心）

| 类型 | 目的 | AI 怎么用 |
|------|------|----------|
| 描述型 | 让学生把过程/思路说出来 | "先给我描述一下这道题的运动过程" |
| 追问型 | 找到断点 | "这个式子对谁列的？""这个V是哪个过程的？" |
| 反例型 | 用矛盾暴露错误 | "一个力可没办法合外力为0" |
| 复做型 | 验证是否真会了 | "你现在自己写一下，给我证明为什么是2G" |

---

## Phase 2: 维度依赖矩阵

> 核心问题：换学科/换地区/换年级/换目标分，系统里哪些东西要改？

### 2.1 四个维度

| 维度 | V1 取值 | 扩展时的取值 |
|------|--------|-------------|
| 学科 | 物理、数学 | 化学、生物、英语… |
| 地区 | 天津 + 另一城市 | 北京、上海、全国卷… |
| 年级 | 高三下 | 高三上、高二、高一… |
| 分数目标 | 每个学生每科一个 | 连续值，如"从 55 到 75" |

### 2.2 依赖矩阵

读法：○ = 完全不变　△ = 内容/范围/权重变，结构不变　✕ = 整套内容不同

| 实体 | 学科变了 | 地区变了 | 年级变了 | 目标分变了 |
|------|---------|---------|---------|-----------|
| **Atom 结构（6字段）** | ○ | ○ | ○ | ○ |
| **Episode 结构** | ○ | ○ | ○ | ○ |
| **问法类型（4种）** | ○ | ○ | ○ | ○ |
| **教学动作（5种）** | ○ | ○ | ○ | ○ |
| **阶段列表** | △ 加学科专属阶段 | ○ | ○ | ○ |
| **错因标签列表** | △ 加学科专属标签 | ○ | ○ | ○ |
| **知识点树** | ✕ 完全不同 | ○ | △ 筛选范围 | ○ |
| **知识点权重** | ✕ | △ 微调 | ○ | △ 优先级变 |
| **考点/模型目录** | ✕ 完全不同 | ○ | △ 筛选范围 | ○ |
| **考点/模型权重（考频）** | ✕ | △ 考频不同 | ○ | △ 优先级变 |
| **卷子结构** | ✕ | ✕ | △ 考试类型不同 | ○ |
| **题库（题目内容）** | ✕ | △ 真题按地区 | △ 超纲筛选 | ○ |
| **题目选取（选哪道给学生）** | ○ | ○ | ○ | △ 难度筛选 |
| **掌握度公式** | ○ 公式不变 | ○ | ○ | ○ |
| **掌握度参数** | △ base_r/base_p可调 | ○ | ○ | ○ |
| **AI 提示词模板** | △ 学科专属片段 | ○ | ○ | △ 话术语气 |
| **学生** | ○（同一学生多科） | 属性 | 属性 | 按学科一个 |

### 2.3 核心结论：三层分离

从矩阵中提取出清晰的三层：

**第一层：永远不改的（引擎）**
- Atom 结构、Episode 结构、问法类型、教学动作、掌握度公式
- 含义：不管加什么学科、什么地区，这些东西的代码一行不用改

**第二层：按学科换一套的（内容包）**
- 知识点树、考点/模型目录、题库、阶段扩展集、错因标签扩展集、AI 提示词学科片段
- 含义：加一个学科 = 加一个内容包，不动引擎

**第三层：按地区×年级×目标分调参数的（配置）**
- 卷子结构、考频权重、知识点优先级、难度筛选阈值、掌握度参数微调
- 含义：加一个地区 = 加一组配置文件，不动引擎也不动内容包

**这就是"一套骨架，无限换皮肤"的具体含义：骨架=引擎，皮肤=内容包+配置。**

### 2.4 阶段的学科差异（物理 vs 数学预估）

| 阶段 | 物理 | 数学 | 是否共享 |
|------|------|------|---------|
| 审题 | ✓ | ✓ | 共享 |
| 过程 | 拆运动段 | 分情况讨论 | 名字不同，本质相似 |
| 条件 | 公式适用条件 | 定理适用条件 | 共享 |
| 主语 | 对谁列式 | 对谁设未知数 | 共享（"主语"概念通用） |
| 方向 | 力/速度/电流方向 | ——（数学无此概念） | 物理专属 |
| 受力分析 | ✓ | ——（数学无此概念） | 物理专属 |
| 列式 | 选公式列方程 | 选方法列方程 | 共享 |
| 计算 | ✓ | ✓ | 共享 |
| 检验 | 物理意义检验 | 数值/定义域检验 | 共享（检验对象不同） |
| 概念 | ✓ | ✓ | 共享 |
| 公式记忆 | ✓ | ✓ | 共享 |
| 画图/辅助线 | ——（不单独列） | ✓ | 数学专属（待教研确认） |
| 数形结合 | ——（不单独列） | ✓ | 数学专属（待教研确认） |

共享 7 个 + 物理专属 2 个 + 数学专属 2 个（待教研验证）= 引擎层只处理共享阶段的通用逻辑，学科专属阶段由内容包定义。

---

## Phase 3: 真相源 vs 派生视图

> 核心原则 P7："没有 AI 介入的东西"和"加工出来的"必须分开存

### 3.1 三层数据模型

| 层 | 名字 | 谁产生的 | 能不能改 | 用老师上课打比方 |
|----|------|---------|---------|----------------|
| L1 | **原始事件** | 学生的手 + 系统时钟 | 不能改（发生了就是发生了） | 学生写在草稿纸上的东西 |
| L2 | **当场判断** | AI 或预设规则 | 可以修正（以后模型更好了可以重判） | 老师当场说的"这一步错了" |
| L3 | **聚合视图** | 从 L1+L2 计算出来 | 随时重算（改了算法就能刷新） | 期末评语"这学生力学不错，电磁差" |

### 3.2 Atom 字段的分层归属

| 字段 | 属于哪层 | 理由 |
|------|---------|------|
| 学生输出（文字/选项） | L1 原始事件 | 学生自己输入的，没有 AI 介入 |
| 用时（秒） | L1 原始事件 | 系统时钟记录的 |
| 问法（系统问了什么） | L1 原始事件 | 虽然是 AI 生成的，但"问了什么"是已发生的事实 |
| stage（在哪个阶段） | L1 原始事件 | 教研预设的，记录"系统测的是哪个阶段" |
| 题目原文 + 标签 | L1 原始事件 | 预设内容，不可篡改 |
| 时间戳 | L1 原始事件 | 系统时钟 |
| 本轮结论（pass/fail/partial） | L2 当场判断 | AI 根据学生输出做的判断 |
| 错因标签（可叠加集合） | L2 当场判断 | AI 判定+教研映射 |
| 关键点 | L2 当场判断 | AI/教研标注"这次交互测的核心是什么" |
| 验证动作（追问/讲解/复做/确认/换卡） | L2 当场判断 | 系统做的决策 |
| 下一步 | L2 当场判断 | 系统做的决策 |

### 3.3 聚合视图全表（L3 层，全部从 L1+L2 计算）

| 视图 | 怎么算 | 给谁看 | v1.0 中的对应 |
|------|--------|-------|--------------|
| 知识点掌握度（mastery_value） | 累加该知识点下所有 Atom 的 pass/fail/partial | 系统内部运算 | v1.0 Section 六 |
| 知识点段位（L0-L5） | mastery_value 映射到离散等级 | 学生+家长 | v1.0 Section 六 |
| 模型掌握度 | 累加该模型下所有 Episode 的 pass/fail | 系统内部运算 | v1.0 Section 八 |
| 模型段位（L0-L5） | mastery_value 映射到离散等级 | 学生+家长 | v1.0 Section 八 |
| 错因模式 | 统计某学生高频错因标签 | 系统+老师 | v1.1 R 编号 |
| 分数预估 | 掌握度 × 卷子结构权重 → 加权求和 | 学生+家长 | v1.0 Section 四 |
| 推荐训练 | 掌握度最低+考频最高的交叉 → 排序 | 学生 | v1.0 Section 五 |
| 进步曲线 | 掌握度的时间序列 | 学生+家长 | 新增 |
| 提分空间 | 每个薄弱模型对应的卷面分值 | 家长（P6 确定性） | v1.0 Section 四 |

### 3.4 关键设计决策

**为什么 L2 要单独存而不是算完扔掉？**
- 因为 L2 是"AI 当时判了什么"的历史记录。如果以后发现判错了，有据可查
- 教研复核时需要看 L2（v1.0 的"诊断准确率"验证就是比较 L2 判断和教研复核）
- P2 原则要求错因可叠加——L2 存错因标签集合，以后可以加新标签到旧记录

**为什么 L3 必须能重算？**
- 因为算法会迭代。v1.0 的 mastery_value 公式里 base_r=8, base_p=12 是初始参数，以后会调
- 改了公式后，从 L1+L2 重新跑一遍就能刷新所有 L3 视图
- 不需要"迁移数据"——只要 L1+L2 不丢，L3 永远可重建

### 3.5 与 P3/P4 产品原则的映射

| 产品 | 用了哪些层 | 具体内容 |
|------|-----------|---------|
| 500 诊断 | L1 采集 → L2 当场判 → L3 一次性快照 | 知识点段位 + 模型段位 + 分数预估 + 提分空间 |
| 3000 使用 | L1 持续采集 → L2 持续判 → L3 持续刷新 | 上面全部 + 进步曲线 + 推荐训练 + 预测分更新 |

500 和 3000 用同一套引擎、同一个数据模型。区别只在于：500 跑一次就输出报告，3000 每周跑一次持续更新。

---

## Phase 4: 统一架构

> 核心目标：一套骨架（引擎），无限换皮肤（内容包+配置）
> 对应 Phase 2 结论的落地设计

### 4.1 三层系统架构

```
┌──────────────────────────────────────────────────┐
│                  配置层（Config）                   │
│  卷子结构 · 考频权重 · 知识点优先级 · 难度阈值       │
│  → 按 [地区 × 年级 × 目标分] 切换                  │
├──────────────────────────────────────────────────┤
│                内容包（Content Pack）                │
│  知识点树 · 模型目录 · 题库 · 阶段扩展 · 错因扩展    │
│  · AI 提示词学科片段 · E/R 编号体系                  │
│  → 按 [学科] 切换                                  │
├──────────────────────────────────────────────────┤
│                  引擎层（Engine）                    │
│  Atom 交互循环 · Episode 管理 · 状态聚合             │
│  · 推荐排序 · 掌握度公式 · 4种问法 · 5种教学动作     │
│  → 永远不改                                        │
└──────────────────────────────────────────────────┘
```

### 4.2 引擎层：做什么

引擎是整个系统的"大脑"，不关心具体学科内容，只处理通用逻辑。

**A. Atom 交互循环（核心循环）**

```
1. 引擎从内容包取：当前 Episode 的下一个该测的阶段
2. 引擎从内容包取：这个阶段的 AI 提示词模板
3. 引擎拼接提示词：模板 + 题目 + 学生历史 + 问法类型
4. AI 生成问题 → 展示给学生
5. 学生输入（选择/文字/数值）→ 记入 L1
6. 引擎拼接判断提示词：学生输出 + 预设答案 + 判断标准
7. AI 返回 pass/fail/partial + 错因标签 → 记入 L2
8. 引擎决策下一步：
   - pass → 进入下一个阶段（或结束 Episode）
   - fail → 选择教学动作（追问/讲解/反例/复做/换卡）
   - partial → 追问确认
9. 回到第 1 步
```

**B. Episode 管理**

| Episode 模式 | 什么时候用 | 行为 |
|-------------|-----------|------|
| diagnose | 500 诊断、首次接触某模型 | 只测不教，碰到 fail 记录后跳到下一个阶段 |
| teach | 3000 日常训练 | 碰到 fail 就教，教完再 verify |
| verify | 复测、检验是否真的会了 | 只测，pass 则掌握度涨，fail 则掌握度降 |

**C. 状态聚合**

引擎定期（每次 Episode 结束后）从 L1+L2 重算 L3：
- 知识点 mastery_value：v1.0 Section 六 的公式（base_r, base_p, confidence, step_weight）
- 模型 mastery_value：v1.0 Section 八 的公式（参数不同）
- 分数预估：每个卷子结构位置对应的模型掌握度 × 该位置的分值 → 求和

**D. 推荐排序**

输入：学生当前所有模型/知识点的 mastery_value + 配置层的考频权重
输出：按"提分效率"排序的推荐列表

```
推荐优先级 = (1 - mastery_value/100) × 考频权重 × 该模型分值
```

意思：越不会的 × 越常考的 × 分值越高的 → 排越前面。

### 4.3 内容包：一个学科长什么样

以物理内容包为例：

```
content_pack_physics/
├── knowledge_tree.json          # 知识点三级树（v1.0 Section 一）
├── model_catalog.json           # 考点/模型三级目录（v1.0 Section 一）
├── problems/                    # 题库
│   ├── T1_母题.json
│   ├── T2_变式题.json
│   ├── T5_诊断题.json
│   └── ...
├── stages_extension.json        # 物理专属阶段：受力分析、方向
├── error_tags_extension.json    # 物理专属错因标签
├── e_codes.json                 # v1.1 的 E 编号体系（9步×子编号）
├── r_codes.json                 # v1.1 的 R 根因编号体系
├── prompts/                     # AI 提示词模板
│   ├── stage_审题.txt
│   ├── stage_过程.txt
│   ├── stage_受力分析.txt
│   ├── diagnose_5轮.txt         # v1.0 Section 二 的诊断提示词
│   ├── teach_讲解.txt
│   └── ...
├── training_flows/              # 训练流程
│   ├── 六步专项.json            # v1.0 Section 五
│   ├── 闪卡模板.json
│   └── 粗心消杀.json
└── mastery_params.json          # 物理的 base_r=8, base_p=12 等参数
```

数学内容包结构完全一样，只是里面的内容不同（知识点树=导数/数列/…，模型=解析几何/放缩/…，专属阶段=画图/数形结合/…）。

### 4.4 配置层：一组配置长什么样

```
config_tianjin_gaosan_xia/
├── paper_structure.json          # 天津高考物理卷结构（8选择+实验+3大题+选做）
├── model_weights.json            # 天津各模型考频（传送带=高，回旋加速器=中…）
├── knowledge_scope.json          # 高三下需要掌握的知识点范围
├── difficulty_tiers.json         # 按目标分的难度分层
│   ├── tier_40_55: { focus: 基础模型, skip: 难题 }
│   ├── tier_55_70: { focus: 中档模型, introduce: 部分难题 }
│   ├── tier_70_85: { focus: 全模型, train: 高频易错 }
│   └── tier_85_95: { focus: 细节, train: 压轴 }
└── display_params.json           # 展示参数（报告话术语气等）
```

### 4.5 数据流：一个完整的学生交互过程

```
张可心打开 APP，学科=物理，地区=天津，年级=高三下，目标=75分
    │
    ▼
引擎加载：物理内容包 + 天津高三下配置
    │
    ▼
引擎查看：张可心的当前 mastery → 模型"回旋加速器" mastery=25（L2）
配置说：回旋加速器考频=中，对应卷子选择题第6题（3分）
推荐排序：回旋加速器排第3
    │
    ▼
引擎创建 Episode：mode=teach, problem=回旋加速器基础题
    │
    ▼
Atom 1: stage=过程
  引擎拼提示词 → AI 问："回旋加速器的粒子做几种运动？[2种/3种/4种]"
  学生选：3种 → L1 记录
  AI 判定：fail（正确=2种）→ L2 记录（错因=过程数量错）
  引擎决策：teach → 讲解"中间匀加速+D盒匀速圆周=2种"
    │
    ▼
Atom 2: stage=列式
  引擎拼提示词 → AI 问："周期T用哪个一级公式推？写出来"
  学生输入："T=2πm/BQ" → L1 记录
  AI 判定：pass（学生直接写出结果，但需检查是否理解推导）→ L2 记录
  引擎决策：追问 → "这个T从哪个式子推出来的？从向心力开始写"
    │
    ▼
Atom 3: stage=列式（追问）
  学生输入："QvB=m·4π²r/T²" → L1 记录
  AI 判定：pass → L2 记录
  引擎决策：进入下一阶段
    │
    ▼
... 继续直到 Episode 结束 ...
    │
    ▼
Episode 结束 → 引擎聚合：
  回旋加速器 mastery_value: 25 → 更新（1 fail + 2 pass → Δ约+5）→ 30
  知识点"向心力公式" mastery: 因 pass 微涨
  错因记录：过程数量错 ×1
    │
    ▼
L3 视图刷新：
  分数预估：从 62 → 63（回旋加速器对应的 3 分概率从 20% → 30%）
  推荐排序：回旋加速器排名从第3 → 第4（进步了，其他更急）
```

### 4.6 v1.0 / v1.1 现有设计如何接入

| v1.0/v1.1 中的设计 | 放在架构的哪层 | 说明 |
|-------------------|--------------|------|
| 9步框架（E编号） | 内容包（物理） | 9步是物理计算题的详细拆分，对应引擎的"阶段"概念 |
| 选择题6步（Es编号） | 内容包（物理） | 选择题的流程变体，引擎同样按 Atom 循环处理 |
| 实验题5步（Ee编号） | 内容包（物理） | 实验题的流程变体 |
| R根因编号 | 内容包（物理） | 比引擎层的"错因标签"更详细，是物理专属的根因细分 |
| mastery_value 公式 | 引擎层 | 公式通用，参数（base_r/base_p/step_weight）按学科在内容包调 |
| L0-L5 段位 | 引擎层 | 映射规则通用，适用于所有学科 |
| 六步专项训练 | 内容包（物理） | 是物理的训练流程，数学可以有自己的训练流程 |
| 闪卡 SM-2 算法 | 引擎层 | 间隔复习是通用算法 |
| 三Tab（知识点/模型/卷子） | 引擎层（前端） | 三个视角的展示框架，所有学科通用 |
| 500诊断流程 | 引擎层 | Episode mode=diagnose 的具体编排 |
| 诊断提示词模板 | 内容包 | 学科相关的提示词片段 |
| 题目来源分类（T1-T9） | 内容包 | 题库的组织方式，所有学科可复用分类逻辑 |

### 4.7 外化动作设计（P1 原则落地）

> P1："系统能拿到什么数据，取决于你设计了什么外化动作"

在真实教学中，老师用开放对话提取学生思维（"描述一下运动过程""这个式子对谁列的"）。
AI 系统需要把这些开放对话转成可判断的结构化交互。

| 阶段 | 老师怎么问（开放） | 系统怎么问（结构化） | 学生输入格式 |
|------|------------------|-------------------|-----------  |
| 审题 | "这道题在说什么？" | "这道题主要考的是哪个模型？ [A/B/C/D]" | 单选 |
| 过程 | "分几段运动？" | "这道题分几段运动？ [1/2/3/4]" + "每段是什么运动？" | 单选+多步 |
| 条件 | "能用动量守恒吗？" | "这个过程能用动量守恒吗？ [能/不能] 理由？ [选项]" | 判断+选择 |
| 主语 | "这个式子对谁列的？" | "你要对谁列方程？ [A物体/B物体/整体]" | 单选 |
| 受力分析 | "受几个力？" | "该物体受哪些力？ [多选：重力/支持力/摩擦力/拉力/…]" | 多选 |
| 列式 | "列什么公式？" | "选择公式 [牛二/动能定理/动量守恒/…]" + 关键量填写 | 选择+填空 |
| 计算 | "算出来多少？" | "计算结果 = ___" | 数值填空 |
| 检验 | "结果合理吗？" | "这个结果物理上合理吗？ [合理/不合理/不确定]" | 单选 |

每一个结构化交互 = 一个 Atom。学生选/填什么 → L1。AI 判对错 → L2。

### 4.8 扩展性验证

| 扩展场景 | 要做什么 | 引擎改吗 | 工作量 |
|---------|---------|---------|-------|
| 加化学 | 做一个化学内容包（知识点树+模型+题库+提示词+专属阶段+专属错因） | 不改 | 内容制作 |
| 加上海 | 加一组上海配置（卷子结构+考频权重+真题） | 不改 | 教研配置 |
| 加高二 | 调整知识点/模型的范围筛选 + 加高二题目 | 不改 | 配置+题库 |
| 改目标分逻辑 | 调配置层的 difficulty_tiers | 不改 | 参数调整 |
| 加新错因标签 | 在内容包的 error_tags_extension 里加一条 | 不改 | P2 原则（加法） |
| 加新阶段（如数学的"数形结合"） | 在内容包的 stages_extension 里加一条 + 加对应提示词 | 不改 | 内容制作 |
| 改 mastery 公式参数 | 改内容包的 mastery_params | 不改 | 参数调整 |
| 改 mastery 公式本身 | 改引擎 + 从 L1+L2 重算所有 L3 | 改（唯一需要改引擎的场景） | 开发+重算 |

**结论：除了改掌握度公式结构本身，所有扩展都不需要动引擎。而公式结构在 v1.0 已经比较稳定了。**

---

## Phase 5: V1 范围定义

### 5.1 V1 构建清单

| 模块 | 属于哪层 | V1 要做的 | 工作量占比 |
|------|---------|----------|-----------|
| 引擎：Atom 交互循环 | 引擎 | 做（完整版） | 25% |
| 引擎：Episode 管理 | 引擎 | 做（3 种模式） | 10% |
| 引擎：状态聚合 | 引擎 | 做（mastery 公式） | 10% |
| 引擎：推荐排序 | 引擎 | 做（基础版） | 5% |
| 引擎：闪卡 SM-2 | 引擎 | 做 | 5% |
| 内容包：物理 | 内容包 | 做（知识点树+模型+E/R 编号+题库+提示词+训练流程） | 20% |
| 内容包：数学 | 内容包 | 做（同上，数学版本） | 15% |
| 配置：天津 | 配置 | 做（卷子结构+考频+权重） | 3% |
| 配置：另一城市 | 配置 | 做 | 2% |
| 前端 | — | 做（三 Tab + 诊断流 + 训练流 + 报告页） | 别处单独规划 |

### 5.2 V1 不构建但引擎已支持的

| 功能 | 为什么不做 | 引擎怎么支持 |
|------|-----------|-------------|
| 化学/生物/英语 | 没有内容包（教研没做） | 加内容包即可接入 |
| 北京/上海/全国卷 | 没有配置（教研没做） | 加配置即可接入 |
| 高二/高一 | 没有范围筛选配置 | 改 knowledge_scope 即可 |
| 家长端 | Phase 0 约束 #4 | — |
| 语音输入 | V1 复杂度控制 | Atom 的学生输出字段支持任何格式 |
| 拍照批改 | V1 复杂度控制 | 同上 |

### 5.3 500 产品规格

**目标**：让学生/家长觉得"第一次有人真正搞清楚了我"（v1.0 原话）

**输入**：
1. 基础信息：地区、年级、目标分
2. 上传最近考试卷（含标准答案）→ 系统批量处理
3. 做 8-12 个诊断 Episode（覆盖该学科核心模型）
   - 每个 Episode: 2-4 个 Atom（碰到 fail 记录，不教，跳下一个阶段）
   - 预计用时：1-2 小时

**引擎行为**：
- Episode mode = diagnose
- Atom 交互使用结构化问法（选择/填空为主）
- 每个 Atom 的 L1+L2 都记录
- 全部做完后一次性聚合 L3

**输出（P3: 三个视角的静态快照）**：
- 知识点掌握全景（哪些绿/黄/红）
- 模型掌握全景（哪些 pass / fail / 未测）
- 分数预估（基于掌握度 × 卷子结构权重）
- Top 3 提分突破口（P6: 给家长确定性）
- 每个突破口的"预计多久能解决"（P6: 安心）

### 5.4 3000 产品规格

**目标**：持续提分到高考（v1.0 原话："3000 = 诊断 + 所有训练 + 持续更新 + 到高考"）

**包含 500 诊断的全部内容**，加上：

**每周循环**：
```
周一-五：2-3 个 teach Episode（针对推荐排序最高的模型/知识点）
周六：1-2 个 verify Episode（复测本周教过的内容）
周日：闪卡复习 + 掌握度衰减检查

每个 teach Episode:
  - 碰到 fail → 引擎选教学动作 → 教完再 verify
  - 约 20-30 分钟/个

每个 verify Episode:
  - 碰到 pass → mastery 涨
  - 碰到 fail → 标记需要再练 → 下周重排优先级
```

**持续更新**：
- 每次 Episode 后刷新 L3
- 每周输出：本周进步摘要 + 更新后的分数预估
- 每月输出：月度报告（进步曲线 + 还有哪些没攻克 + 预计高考分）

**从 500 升级到 3000 的技术成本**：
- 引擎层：零改动（同一套代码）
- 数据层：500 的 L1+L2 直接复用（不丢失、不重做）
- 前端层：解锁训练入口 + 周报月报页面

### 5.5 V1 内容准备清单（教研侧）

| 项 | 物理 | 数学 | 负责 |
|----|------|------|------|
| 知识点三级树 | 已有（v1.0） | 待制作 | 教研 |
| 模型三级目录 | 已有（v1.0） | 待制作 | 教研 |
| E 编号体系 | 已有（v1.1，计算9步+选择6步+实验5步） | 待制作 | 教研 |
| R 根因编号 | 已有（v1.1） | 待制作 | 教研 |
| 诊断题（T5） | 每模型 2 道母题 → 至少 30 道 | 同上 | 教研 |
| 训练题（T2） | 每模型 5-10 道变式 → 至少 100 道 | 同上 | 教研 |
| 知识点检测题（T3） | 每知识点 2-3 道 | 同上 | 教研 |
| AI 提示词模板 | 每阶段 1 个诊断 + 1 个教学 → 至少 22 个 | 同上 | 教研+开发 |
| 天津卷子结构 | 待整理 | 待整理 | 教研 |
| 天津考频权重 | 待整理 | 待整理 | 教研 |
| 另一城市卷子结构 | 待整理 | 待整理 | 教研 |
| 另一城市考频权重 | 待整理 | 待整理 | 教研 |

### 5.6 一句话总结 V1 的构建策略

> 引擎做满（通用、可复用），内容做精（只做物理+数学、只做天津+1城市），配置做薄（只做高三下）。
> 引擎是投资，内容包是产品，配置是调参。
> 加学科=加内容包，加地区=加配置，加年级=改筛选。引擎一行不改。
